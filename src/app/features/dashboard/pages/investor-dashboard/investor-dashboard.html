<app-table-layout
  [tableTitle]="'dashboard.title' | translate"
  [tableSubTitle]="'dashboard.subtitle' | translate"
  pageTitleClass="text-[24px] font-semibold"
  pageSubTitleClass="text-md text-gray-600"
>
  <ng-container ngProjectAs="table-actions">
    <p-button
      [label]="'dashboard.submitNewPlan' | translate"
      [icon]="'icon-plus'"
      [size]="'small'"
      (onClick)="createNewPlan()"
    />
  </ng-container>

  <!-- Statistics Cards -->
  <ng-container ngProjectAs="table-filters">
    <div class="w-full grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      @if(isStatisticsLoading()) {
      <!-- Skeleton Loading State -->
      @for (item of [1, 2, 3, 4]; track item) {
      <div class="bg-white rounded-xl border-1 border-gray-200 p-6">
        <p-skeleton width="120px" height="16px" class="mb-2" />
        <p-skeleton width="60px" height="32px" class="mb-4" />
        <div class="flex items-center gap-1">
          <p-skeleton width="100px" height="16px" />
          <p-skeleton width="16px" height="16px" shape="circle" />
        </div>
      </div>
      } } @else {
      <!-- Total Plans -->
      <div
        class="bg-white rounded-xl border-1 border-gray-200 p-6 cursor-pointer hover:shadow-md transition-shadow"
      >
        <p class="text-sm font-medium text-gray-600 mb-2">
          {{ 'plans.statistics.totalPlans' | translate }}
        </p>
        <p class="text-2xl font-semibold text-gray-900 mb-4">
          {{ statistics()?.totalPlans ?? 0 }}
        </p>
        <div class="flex items-center gap-1 text-primary-600 cursor-pointer">
          <span class="text-sm font-semibold">
            {{ 'opportunity.counts.viewDetails' | translate }}
          </span>
          <i class="icon-arrow-right-up text-xs text-primary-600 ms-1"></i>
        </div>
      </div>

      <!-- Plans Under Review -->
      <div
        class="bg-white rounded-xl border-1 border-gray-200 p-6 cursor-pointer hover:shadow-md transition-shadow"
      >
        <p class="text-sm font-medium text-gray-600 mb-2">
          {{ 'plans.statistics.plansUnderReview' | translate }}
        </p>
        <p class="text-2xl font-semibold text-gray-900 mb-4">
          {{ statistics()?.plansUnderReview ?? 0 }}
        </p>
        <div class="flex items-center gap-1 text-primary-600 cursor-pointer">
          <span class="text-sm font-semibold">
            {{ 'opportunity.counts.viewDetails' | translate }}
          </span>
          <i class="icon-arrow-right-up text-xs text-primary-600 ms-1"></i>
        </div>
      </div>

      <!-- Approved Plans -->
      <div
        class="bg-white rounded-xl border-1 border-gray-200 p-6 cursor-pointer hover:shadow-md transition-shadow"
      >
        <p class="text-sm font-medium text-gray-600 mb-2">
          {{ 'plans.statistics.approvedPlans' | translate }}
        </p>
        <p class="text-2xl font-semibold text-gray-900 mb-4">
          {{ statistics()?.approvedPlans ?? 0 }}
        </p>
        <div class="flex items-center gap-1 text-primary-600 cursor-pointer">
          <span class="text-sm font-semibold">
            {{ 'opportunity.counts.viewDetails' | translate }}
          </span>
          <i class="icon-arrow-right-up text-xs text-primary-600 ms-1"></i>
        </div>
      </div>

      <!-- Rejected Plans -->
      <div
        class="bg-white rounded-xl border-1 border-gray-200 p-6 cursor-pointer hover:shadow-md transition-shadow"
      >
        <p class="text-sm font-medium text-gray-600 mb-2">
          {{ 'plans.statistics.rejectedPlans' | translate }}
        </p>
        <p class="text-2xl font-semibold text-gray-900 mb-4">
          {{ statistics()?.rejectedPlans ?? 0 }}
        </p>
        <div class="flex items-center gap-1 text-primary-600 cursor-pointer">
          <span class="text-sm font-semibold">
            {{ 'opportunity.counts.viewDetails' | translate }}
          </span>
          <i class="icon-arrow-right-up text-xs text-primary-600 ms-1"></i>
        </div>
      </div>
      }
    </div>

    <!-- Filters -->
    <app-investor-dashboard-plans-filter></app-investor-dashboard-plans-filter>
  </ng-container>

  <ng-container ngProjectAs="table-body">
    <app-table-skeleton [headers]="headers()" [isLoading]="isLoading()">
      <app-data-table
        [columns]="headers()"
        [rows]="rows()"
        [(filter)]="filterService.filter"
        [totalRecords]="totalRecords()"
        (filterChange)="filterService.applyFilterWithPaging()"
        [messageTitle]="'plans.list.noPlansFound' | translate"
        [showCheckBox]="false"
        [rowsCheckable]="false"
      >
        <ng-template #itemsTemplate let-item="item">
          <td>
            {{ '#' + item.planCode }}
          </td>
          <td>
            <p class="text-sm text-gray-900 font-medium">{{ item.title }}</p>
          </td>
          <td>
            <span class="text-sm text-gray-600">{{ getPlanTypeLabel(item.planType) }}</span>
          </td>
          <td>{{ item.submissionDate | date : 'dd/MM/yyyy' }}</td>
          <td>
            @if(item.status == eEmployeePlanStatus.PENDING) {

            <span
              class="text-sm font-medium"
              [ngClass]="
                item.slaCountDown >= 5
                  ? 'text-[#067647]'
                  : item.slaCountDown > 2
                  ? 'text-[#F78F3A]'
                  : 'text-[#B42318]'
              "
            >
              {{ item.slaCountDown }} {{ 'plans.table.daysRemaining' | translate }}
            </span>
            } @else {
            <span class="text-sm font-medium text-center">-</span>
            }
          </td>
          <td>
            <span
              class="text-sm font-medium inline-block border-1 px-[10px] py-[2px] rounded-xl {{
                getStatusBadgeClass(item.status)
              }}"
            >
              {{ getStatusLabel(item.status) }}
            </span>
          </td>
          <td>
            <app-investor-dashboard-plan-action-menu
              [plan]="item"
              (onViewDetails)="onViewDetails($event)"
              (onEdit)="onEdit($event)"
              (onDownload)="onDownload($event)"
              (onViewTimeLine)="onViewTimeline($event)"
            />
          </td>
        </ng-template>
      </app-data-table>
    </app-table-skeleton>
  </ng-container>
</app-table-layout>

@if(planTermsAndConditionsDialogVisibility()){
<app-plan-terms-and-conditions-dialog
  [(visibility)]="planTermsAndConditionsDialogVisibility"
  (onConfirm)="onUserReadAndApproved()"
/>
} @if(newPlanDialogVisibility()){
<app-new-plan-dialog
  [(visibility)]="newPlanDialogVisibility"
  (onConfirm)="onUserConfirmNewPlanDialog()"
/>
} @if(productLocalizationPlanWizardVisibility()){
<app-product-localization-plan-wizard
  [(visibility)]="productLocalizationPlanWizardVisibility"
  (doRefresh)="applyFilter()"
/>
} @if(serviceLocalizationPlanWizardVisibility()){
<app-service-localization-plan-wizard
  [(visibility)]="serviceLocalizationPlanWizardVisibility"
  (doRefresh)="applyFilter()"
/>
} @if(timelineVisibility()){
<app-timeline-dialog [(dialogVisible)]="timelineVisibility" [planId]="selectedPlan()?.id || null" />
}
