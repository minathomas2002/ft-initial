<div class="flex flex-col gap-8 pb-10">
  @if(isLoading()) {
  <!-- Skeleton Loading State -->
  <div class="flex flex-col gap-8">
    <!-- Basic Information Skeleton -->
    <div>
      <p-skeleton width="200px" height="24px" class="mb-4" />
      <div class="flex flex-col gap-4">
        <div class="flex flex-col gap-2">
          <p-skeleton width="150px" height="16px" />
          <p-skeleton width="100%" height="40px" />
        </div>
        <div class="flex flex-col gap-2">
          <p-skeleton width="150px" height="16px" />
          <p-skeleton width="100%" height="96px" />
        </div>
        <div class="flex flex-col gap-2">
          <p-skeleton width="150px" height="16px" />
          <p-skeleton width="50%" height="40px" />
        </div>
        <div class="flex flex-col gap-2">
          <p-skeleton width="150px" height="16px" />
          <p-skeleton width="50%" height="40px" />
        </div>
      </div>
    </div>

    <!-- Forecasted Demand Skeleton -->
    <div>
      <p-skeleton width="250px" height="24px" class="mb-4" />
      <div class="flex flex-col gap-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
          <div class="flex flex-col gap-2">
            <p-skeleton width="120px" height="16px" />
            <p-skeleton width="100%" height="40px" />
          </div>
          <div class="flex flex-col gap-2">
            <p-skeleton width="120px" height="16px" />
            <div class="flex gap-2">
              <p-skeleton width="48%" height="40px" />
              <p-skeleton width="48%" height="40px" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Suppliers Base Skeleton -->
    <div>
      <p-skeleton width="150px" height="24px" class="mb-4" />
      <div class="flex flex-col gap-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
          <div class="flex flex-col gap-2">
            <p-skeleton width="120px" height="16px" />
            <p-skeleton width="100%" height="40px" />
          </div>
          <div class="flex flex-col gap-2">
            <p-skeleton width="120px" height="16px" />
            <p-skeleton width="100%" height="40px" />
          </div>
        </div>
      </div>
    </div>

    <!-- Opportunity Dates Skeleton -->
    <div>
      <p-skeleton width="180px" height="24px" class="mb-4" />
      <div class="flex flex-col gap-4">
        <div class="flex flex-col gap-2">
          <p-skeleton width="100px" height="16px" />
          <p-skeleton width="50%" height="40px" />
        </div>
      </div>
    </div>

    <!-- Opportunity Image Skeleton -->
    <div>
      <p-skeleton width="180px" height="24px" class="mb-4" />
      <div class="flex flex-col gap-4">
        <div class="flex flex-col gap-2">
          <p-skeleton width="80px" height="16px" />
          <p-skeleton width="100%" height="120px" />
        </div>
      </div>
    </div>
  </div>
  } @else {
  <!-- Basic Information -->
  <div>
    <h3 class="text-lg font-semibold mb-4">{{ 'opportunity.form.basicInformation' | translate }}</h3>
    <div class="flex flex-col gap-4">
      <!-- Title -->
      <div class="flex flex-col">
        <app-base-label [title]="'opportunity.form.opportunityTitle' | translate">
        </app-base-label>
        <input type="text" pInputText [disabled]="opportunitiesStore.details()?.hasActivePlans ?? false"
          [placeholder]="'opportunity.form.enterOpportunityTitle' | translate" [formControl]="getControl('title')"
          [maxlength]="150" />
        <app-base-error-messages [control]="getControl('title')"
          [label]="'opportunity.form.opportunityTitle' | translate" />
      </div>
      <!-- Short Description -->
      <div class="flex flex-col">
        <app-base-label [title]="'opportunity.form.shortDescription' | translate" />
        <textarea pTextarea [rows]="2" [placeholder]="'opportunity.form.enterShortDescription' | translate"
          [formControl]="getControl('shortDescription')" [maxlength]="255">
        </textarea>
        <!-- Character Counter -->
        <div class="text-xs text-gray-500 text-right mt-1">
          {{ getControl('shortDescription').value?.length || 0 }} / 255
        </div>
        <app-base-error-messages [control]="getControl('shortDescription')"
          [label]="'opportunity.form.shortDescription' | translate" />
      </div>

      <!-- Opportunity Category -->
      <div class="flex flex-col">
        <app-base-label [title]="'opportunity.form.opportunityCategory' | translate" />
        <p-select [formControl]="getControl('opportunityCategory')" [options]="opportunityCategories()"
          optionLabel="name" optionValue="id" [placeholder]="'opportunity.form.select' | translate" class="md:w-[50%]">
          <ng-template pTemplate="item" let-item>
            <div class="flex items-center gap-2">
              <i [class]="item.icon"></i>
              {{ item.name }}
            </div>
          </ng-template>
        </p-select>
        <app-base-error-messages [control]="getControl('opportunityCategory')"
          [label]="'opportunity.form.opportunityCategory' | translate" />
      </div>

      <!-- Opportunity Type -->
      <div class="flex flex-col">
        <app-base-label [title]="'opportunity.form.opportunityType' | translate" />
        <p-select [formControl]="getControl('opportunityType')" [options]="opportunityTypes()" optionLabel="name"
          optionValue="id" [appendTo]="'body'" [placeholder]="'opportunity.form.select' | translate" class="md:w-[50%]">
          <ng-template pTemplate="item" let-item>
            {{ item.name | translate }}
          </ng-template>
          <ng-template pTemplate="selectedItem" let-item>
            {{ item.name | translate }}
          </ng-template>
        </p-select>
        <app-base-error-messages [control]="getControl('opportunityType')"
          [label]="'opportunity.form.opportunityType' | translate" />
      </div>
    </div>
  </div>

  <!-- Forecasted SEC Demand (2024â€“2030) -->
  <div>
    <h3 class="text-lg font-semibold mb-4">{{forecastedDemand()}}</h3>
    <div class="flex flex-col gap-4">
      <!-- Min Quantity -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
        <div class="flex flex-col">
          <app-base-label [title]="'opportunity.form.spendSAR' | translate" />
          <p-inputgroup class="w-full">
            <p-inputnumber mode="decimal" [maxlength]="5" [minFractionDigits]="0" [maxFractionDigits]="3"
              [placeholder]="'opportunity.form.enterSpendSAR' | translate" [formControl]="getControl('spendSAR')" />
            <p-inputgroup-addon class="sar">$</p-inputgroup-addon>
          </p-inputgroup>
          <app-base-error-messages [control]="getControl('spendSAR')"
            [label]="'opportunity.form.spendSAR' | translate" />
        </div>
        <div>
          <app-base-label [title]="'opportunity.form.quantityUnits' | translate" />
          <div class="flex gap-2">
            <div>
              <p-inputnumber [placeholder]="'opportunity.form.enterMinQuantity' | translate"
                [formControl]="getControl('minQuantity')" />
              <app-base-error-messages [control]="getControl('minQuantity')"
                [label]="'opportunity.form.minQuantity' | translate" />
            </div>
            <span class="text-gray-700 text-xl font-semibold pt-1"> - </span>
            <div>
              <p-inputnumber [placeholder]="'opportunity.form.enterMaxQuantity' | translate"
                [formControl]="getControl('maxQuantity')" />
              <app-base-error-messages [control]="getControl('maxQuantity')"
                [label]="'opportunity.form.maxQuantity' | translate" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Suppliers Base -->
  <div>
    <h3 class="text-lg font-semibold mb-4">{{ 'opportunity.form.supplierBase' | translate }}</h3>
    <div class="flex flex-col gap-4">
      <!-- Min Quantity -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
        <div class="flex flex-col">
          <app-base-label [title]="'opportunity.form.localSuppliers' | translate" />
          <p-inputnumber [placeholder]="'opportunity.form.enterLocalSuppliersNumber' | translate"
            [formControl]="getControl('localSuppliers')" [maxlength]="9" />
          <app-base-error-messages [control]="getControl('localSuppliers')"
            [label]="'opportunity.form.localSuppliers' | translate" />
        </div>
        <div class="flex flex-col">
          <app-base-label [title]="'opportunity.form.globalSuppliers' | translate" />
          <p-inputnumber [placeholder]="'opportunity.form.enterGlobalSuppliersNumber' | translate"
            [formControl]="getControl('globalSuppliers')" [maxlength]="9" />
          <app-base-error-messages [control]="getControl('globalSuppliers')"
            [label]="'opportunity.form.globalSuppliers' | translate" />
        </div>
      </div>
    </div>
  </div>

  <!-- Opportunity Dates -->
  <div>
    <h3 class="text-lg font-semibold mb-4">{{ 'opportunity.form.opportunityDates' | translate }}</h3>
    <div class="flex flex-col gap-4">
      <!-- Start / End Dates -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-2 md:w-[50%]">
        <div class="flex flex-col gap-2">
          <app-base-label [title]="'opportunity.form.startDate' | translate" />
          <p-datepicker [showIcon]="true" [showTime]="false"
            [ngModel]="opportunityInformationForm.get('startDate')?.value" (ngModelChange)="onStartDateChange($event)"
            [placeholder]="'opportunity.form.selectStartDate' | translate" [dateFormat]="'dd M yy'" [minDate]="today"
            [disabled]="getControl('startDate').disabled" class="w-full" keepInvalid
            [invalid]="getControl('startDate').invalid && getControl('startDate').dirty" fluid />
          <app-base-error-messages [control]="getControl('startDate')"
            [label]="'opportunity.form.startDate' | translate" />
        </div>

        <div class="flex flex-col gap-2">
          <app-base-label [title]="'opportunity.form.endDate' | translate" />
          <p-datepicker [showIcon]="true" [showTime]="false"
            [ngModel]="opportunityInformationForm.get('endDate')?.value" (ngModelChange)="onEndDateChange($event)"
            [placeholder]="'opportunity.form.selectEndDate' | translate" [dateFormat]="'dd M yy'"
            [minDate]="(getControl('startDate').value && getControl('startDate').value > today) ? getControl('startDate').value : today"
            class="w-full" keepInvalid [invalid]="getControl('endDate').invalid && getControl('endDate').dirty" fluid />
          <app-base-error-messages [control]="getControl('endDate')"
            [label]="'opportunity.form.endDate' | translate" />
        </div>
      </div>
    </div>
  </div>

  <!-- Opportunity Image -->
  <div>
    <h3 class="text-lg font-semibold mb-4">{{ 'opportunity.form.opportunityImage' | translate }}</h3>
    <div class="flex flex-col gap-4">
      <!-- Image -->
      <div class="flex flex-col gap-2">
        <app-base-label [title]="'opportunity.form.image' | translate" />
        <app-fileupload [acceptedFileTypes]="'.jpg, .jpeg, .png'" [files]="files()" [placeholder]="placeholder()"
          #fileupload (filesChange)="onFilesChanged($event)"
          [class.p-invalid]="getControl('image').invalid && getControl('image').dirty" />
        <app-base-error-messages [control]="getControl('image')"
          [label]="'opportunity.form.image' | translate" />
      </div>
    </div>
  </div>
  }
</div>