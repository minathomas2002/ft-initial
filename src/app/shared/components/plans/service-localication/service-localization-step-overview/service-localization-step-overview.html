<div class="flex flex-col gap-[32px] pb-10">
  <!-- Basic Information -->
  <div class="flex flex-col gap-4">
    <h2 class="text-lg font-semibold text-gray-900">Basic Information</h2>
    <div class="flex flex-col gap-4 md:flex-row">
      <div class="flex flex-col gap-2 flex-1">
        <app-base-label [title]="'Opportunity'" />
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="getHasCommentControl(basicInformationFormGroupControls['opportunity'])"
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'basicInformation',
            inputKey: 'opportunity',
            label: 'Opportunity'
          })"
        >
          <p-select
            [options]="availableOpportunities()"
            [formControl]="getFormControl(basicInformationFormGroupControls['opportunity'])"
            optionLabel="name"
            placeholder="Select opportunity"
            [loading]="isLoadingAvailableOpportunities()"
            fluid
            [disabled]="isOpportunityDisabled()"
            [appConditionalColorClass]="highlightInput('opportunity')"
            [color]="selectedInputColor()"
          />
        </app-group-input-with-checkbox>
        <app-base-error-messages
          [control]="getFormControl(basicInformationFormGroupControls['opportunity'])"
          [label]="'Opportunity'"
        />
      </div>
      <div class="flex flex-col gap-2 flex-1">
        <app-base-label [title]="'Submission Date'" />
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="getHasCommentControl(basicInformationFormGroupControls['submissionDate'])"
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'basicInformation',
            inputKey: 'submissionDate',
            label: 'Submission Date'
          })"
        >
          <p-datepicker
            fluid
            dateFormat="dd M yy"
            [formControl]="getFormControl(basicInformationFormGroupControls['submissionDate'])"
            [appConditionalColorClass]="highlightInput('submissionDate')"
            [color]="selectedInputColor()"
          />
        </app-group-input-with-checkbox>
        <app-base-error-messages
          [control]="getFormControl(basicInformationFormGroupControls['submissionDate'])"
          [label]="'Submission Date'"
        />
      </div>
    </div>
  </div>

  <!-- Company Information -->
  <div class="flex flex-col gap-4">
    <h2 class="text-lg font-semibold text-gray-900">Company Information</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-1">
      <div class="flex flex-col gap-2 col-span-1">
        <app-base-label [title]="'Company Name'" />
        <input
          type="text"
          pInputText
          fluid
          [maxlength]="100"
          placeholder="Enter company name"
          [formControl]="getValueControl(companyInformationFormGroupControls['companyName'])"
        />
        <app-base-error-messages
          [control]="getValueControl(companyInformationFormGroupControls['companyName'])"
          [label]="'Company Name'"
        />
      </div>
    </div>
    <div class="flex flex-col gap-4 md:flex-row">
      <div class="flex flex-col gap-2 flex-1">
        <app-base-label [title]="'CEO Name'" />
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="getHasCommentControl(companyInformationFormGroupControls['ceoName'])"
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'overviewCompanyInformation',
            inputKey: 'ceoName',
            label: 'CEO Name'
          })"
        >
          <input
            type="text"
            pInputText
            fluid
            placeholder="Enter CEO name"
            [maxlength]="100"
            [formControl]="getValueControl(companyInformationFormGroupControls['ceoName'])"
            [appConditionalColorClass]="highlightInput('ceoName')"
            [color]="selectedInputColor()"
          />
        </app-group-input-with-checkbox>
        <app-base-error-messages
          [control]="getValueControl(companyInformationFormGroupControls['ceoName'])"
          [label]="'CEO Name'"
        />
      </div>
      <div class="flex flex-col gap-2 flex-1">
        <app-base-label [title]="'CEO Email'" />
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="getHasCommentControl(companyInformationFormGroupControls['ceoEmailID'])"
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'overviewCompanyInformation',
            inputKey: 'ceoEmailID',
            label: 'CEO Email'
          })"
        >
          <input
            type="email"
            pInputText
            fluid
            placeholder="Enter CEO email ID"
            maxlength="100"
            [formControl]="getValueControl(companyInformationFormGroupControls['ceoEmailID'])"
            [appConditionalColorClass]="highlightInput('ceoEmailID')"
            [color]="selectedInputColor()"
          />
        </app-group-input-with-checkbox>
        <app-base-error-messages
          [control]="getValueControl(companyInformationFormGroupControls['ceoEmailID'])"
          [label]="'CEO Email'"
        />
      </div>
    </div>
  </div>

  <!-- Location Information -->
  <div class="flex flex-col gap-4">
    <h2 class="text-lg font-semibold text-gray-900">Location Information</h2>

    <div class="flex flex-col gap-4 md:flex-row">
      <div class="flex flex-col gap-2 flex-1">
        <app-base-label [title]="'Global HQ Location'" />
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="
            getHasCommentControl(locationInformationFormGroupControls['globalHQLocation'])
          "
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'locationInformation',
            inputKey: 'globalHQLocation',
            label: 'Global HQ Location'
          })"
        >
          <input
            type="text"
            pInputText
            fluid
            placeholder="Enter global HQ location"
            [maxlength]="255"
            [formControl]="getValueControl(locationInformationFormGroupControls['globalHQLocation'])"
            [appConditionalColorClass]="highlightInput('globalHQLocation')"
            [color]="selectedInputColor()"
          />
        </app-group-input-with-checkbox>
        <app-base-error-messages
          [control]="getValueControl(locationInformationFormGroupControls['globalHQLocation'])"
          [label]="'Global HQ Location'"
        />
      </div>
      <div class="flex flex-col gap-2 flex-1">
        <div>
          <app-base-label [title]="'Registered Vendor ID with SEC'" />
          <span class="text-sm text-gray-600 ms-2">(If available)</span>
        </div>
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="getHasCommentControl(locationInformationFormGroupControls['registeredVendorIDwithSEC'])"
          (valueChanged)="upDateSelectedInputs($event, {
              section: 'locationInformation',
              inputKey: 'registeredVendorIDwithSEC',
              label: 'Registered Vendor ID with SEC'
            })"
        >
          <p-inputnumber
            [formControl]="getValueControl(locationInformationFormGroupControls['registeredVendorIDwithSEC'])"
            [appConditionalColorClass]="highlightInput('registeredVendorIDwithSEC')"
            [color]="selectedInputColor()"
            [maxlength]="7"
            [useGrouping]="false"
            [minFractionDigits]="0"
            [maxFractionDigits]="0"
            fluid
            placeholder="Enter registered vendor ID with SEC"
          />
        </app-group-input-with-checkbox>
        <app-base-error-messages
          [control]="getValueControl(locationInformationFormGroupControls['registeredVendorIDwithSEC'])"
          [label]="'Registered Vendor ID with SEC'"
        />
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-1">
      <div class="flex flex-col gap-2 col-span-1">
        <app-base-label [title]="'BENA Registered Vendor ID'" />
        <input
          type="text"
          pInputText
          fluid
          placeholder="Enter BENA registered vendor ID"
          [maxlength]="50"
          [formControl]="getValueControl(locationInformationFormGroupControls['benaRegisteredVendorID'])"
        />
      </div>
    </div>

    <div class="flex flex-col gap-4 md:flex-row">
      <div class="flex flex-col gap-2 flex-1">
        <div>
          <h4 class="text-sm font-medium text-gray-900">
            Do you currently have local Agent in KSA?
          </h4>
          <p class="text-sm text-gray-600">
            If “Yes”, mention the following details of Local Agent -
          </p>
        </div>
        <div class="flex gap-2">
          <label class="flex items-center gap-2 cursor-pointer">
            <p-radiobutton
              name="doYouCurrentlyHaveLocalAgentInKSA"
              [value]="true"
              [formControl]="
                getFormControl(
                  locationInformationFormGroupControls['doYouCurrentlyHaveLocalAgentInKSA']
                )
              "
              inputId="doYouCurrentlyHaveLocalAgentInKSAYes"
              size="small"
            />
            <span class="min-w-[100px] text-sm text-gray-700 font-medium">Yes</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <p-radiobutton
              name="doYouCurrentlyHaveLocalAgentInKSA"
              [value]="false"
              [formControl]="
                getFormControl(
                  locationInformationFormGroupControls['doYouCurrentlyHaveLocalAgentInKSA']
                )
              "
              inputId="doYouCurrentlyHaveLocalAgentInKSANo"
              size="small"
            />
            <span class="min-w-[100px] text-sm text-gray-700 font-medium">No</span>
          </label>
        </div>
        <app-base-error-messages
          [control]="
            getFormControl(locationInformationFormGroupControls['doYouCurrentlyHaveLocalAgentInKSA'])
          "
          [label]="'Do you currently have local Agent in KSA?'"
        />
      </div>
    </div>

    @if(showLocalAgentInformation()){
    <div
      class="animated flex flex-col gap-4"
      animate.enter="fadeIn"
    >
      <div class="flex flex-col gap-2 w-full">
        <app-base-label [title]="'Local Agent Details'" />
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="getHasCommentControl(localAgentInformationFormGroupControls['localAgentDetails'])"
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'localAgentInformation',
            inputKey: 'localAgentDetails',
            label: 'Local Agent Details'
          })"
        >
          <textarea
            pTextarea
            fluid
            [maxlength]="255"
            placeholder="Enter local agent details"
            [formControl]="getValueControl(localAgentInformationFormGroupControls['localAgentDetails'])"
            [appConditionalColorClass]="highlightInput('localAgentDetails')"
            [color]="selectedInputColor()"
          ></textarea>
        </app-group-input-with-checkbox>
        <app-base-error-messages
          [control]="getValueControl(localAgentInformationFormGroupControls['localAgentDetails'])"
          [label]="'Local Agent Details'"
        />
        @if (!getValueControl(localAgentInformationFormGroupControls['localAgentDetails']).disabled) {
          <div class="text-xs text-gray-500 text-right mt-1">
            {{ getValueControl(localAgentInformationFormGroupControls['localAgentDetails']).value?.length || 0 }} / 255
          </div>
        }
      </div>

      <div class="flex flex-col gap-4 md:flex-row">
        <div class="flex flex-col gap-2 flex-1">
          <app-base-label [title]="'Local Agent Name'" />
          <app-group-input-with-checkbox
            [showCheckbox]="showCheckbox()"
            [hasCommentControl]="
              getHasCommentControl(localAgentInformationFormGroupControls['localAgentName'])
            "
            (valueChanged)="upDateSelectedInputs($event, {
              section: 'localAgentInformation',
              inputKey: 'localAgentName',
              label: 'Local Agent Name'
            })"
          >
            <input
              type="text"
              pInputText
              fluid
              placeholder="Enter local agent name"
              [maxlength]="100"
              [formControl]="getValueControl(localAgentInformationFormGroupControls['localAgentName'])"
              [appConditionalColorClass]="highlightInput('localAgentName')"
              [color]="selectedInputColor()"
            />
          </app-group-input-with-checkbox>
          <app-base-error-messages
            [control]="getValueControl(localAgentInformationFormGroupControls['localAgentName'])"
            [label]="'Local Agent Name'"
          />
        </div>
        <div class="flex flex-col gap-2 flex-1">
          <app-base-label [title]="'Contact Person Name'" />
          <app-group-input-with-checkbox
            [showCheckbox]="showCheckbox()"
            [hasCommentControl]="
              getHasCommentControl(localAgentInformationFormGroupControls['contactPersonName'])
            "
            (valueChanged)="upDateSelectedInputs($event, {
              section: 'localAgentInformation',
              inputKey: 'contactPersonName',
              label: 'Contact Person Name'
            })"
          >
            <input
              type="text"
              pInputText
              fluid
              placeholder="Enter contact person name"
              [maxlength]="100"
              [formControl]="
                getValueControl(localAgentInformationFormGroupControls['contactPersonName'])
              "
              [appConditionalColorClass]="highlightInput('contactPersonName')"
              [color]="selectedInputColor()"
            />
          </app-group-input-with-checkbox>
          <app-base-error-messages
            [control]="getValueControl(localAgentInformationFormGroupControls['contactPersonName'])"
            [label]="'Contact Person Name'"
          />
        </div>
      </div>

      <div class="flex flex-col gap-4 md:flex-row">
        <div class="flex flex-col gap-2 flex-1">
          <app-base-label [title]="'Email ID'" />
          <app-group-input-with-checkbox
            [showCheckbox]="showCheckbox()"
            [hasCommentControl]="
              getHasCommentControl(localAgentInformationFormGroupControls['emailID'])
            "
            (valueChanged)="upDateSelectedInputs($event, {
              section: 'localAgentInformation',
              inputKey: 'emailID',
              label: 'Email ID'
            })"
          >
            <input
              type="email"
              pInputText
              fluid
              placeholder="Enter email ID"
              [formControl]="getValueControl(localAgentInformationFormGroupControls['emailID'])"
              [appConditionalColorClass]="highlightInput('emailID')"
              [color]="selectedInputColor()"
            />
          </app-group-input-with-checkbox>
          <app-base-error-messages
            [control]="getValueControl(localAgentInformationFormGroupControls['emailID'])"
            [label]="'Email ID'"
          />
        </div>
        <div class="flex flex-col gap-2 flex-1">
          <app-base-label [title]="'Contact Number'" />
          <app-group-input-with-checkbox
            [showCheckbox]="showCheckbox()"
            [hasCommentControl]="
              getHasCommentControl(localAgentInformationFormGroupControls['contactNumber'])
            "
            (valueChanged)="upDateSelectedInputs($event, {
              section: 'localAgentInformation',
              inputKey: 'contactNumber',
              label: 'Contact Number'
            })"
          >
            <app-phone-input
              [formControl]="getValueControl(localAgentInformationFormGroupControls['contactNumber'])"
              [appConditionalColorClass]="highlightInput('contactNumber')"
              [color]="selectedInputColor()"
            ></app-phone-input>
          </app-group-input-with-checkbox>
          <app-base-error-messages
            [control]="getValueControl(localAgentInformationFormGroupControls['contactNumber'])"
            [label]="'Contact Number'"
          />
        </div>
      </div>
      <div class="flex flex-col gap-2 w-full md:w-1/2">
        <app-base-label [title]="'Company HQ Location'" />
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="
            getHasCommentControl(localAgentInformationFormGroupControls['companyLocation'])
          "
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'localAgentInformation',
            inputKey: 'companyLocation',
            label: 'Company HQ Location'
          })"
        >
          <input
            type="text"
            pInputText
            fluid
            placeholder="Enter Company HQ Location"
            [formControl]="getValueControl(localAgentInformationFormGroupControls['companyLocation'])"
            [appConditionalColorClass]="highlightInput('companyLocation')"
            [color]="selectedInputColor()"
          />
        </app-group-input-with-checkbox>
        <app-base-error-messages
          [control]="getValueControl(localAgentInformationFormGroupControls['companyLocation'])"
          [label]="'Company HQ Location'"
        />
      </div>
    </div>
    }
  </div>

  <!-- Details of Service Provided -->
  <div class="flex flex-col gap-4">
    <h2 class="text-lg font-semibold text-gray-900">Details of Service Provided</h2>
    <div class="border border-gray-300 rounded-2xl">
      <app-form-array-input
        [ft]="getDetailsFormArray()"
        [hideAddButton]="true"
        [hideDeleteButton]="isViewMode() || isReviewMode()"
        [showIndexColumn]="true"
        [indexColumnLabel]="'# of Services'"
        [excludeKeys]="['serviceId', 'serviceProvidedToCompanyNames', 'agreementCopy']"
        [headerTooltips]="{
              serviceType:`1) Technical (Core) Services: Services directly related to the planning, construction, operation, maintenance, testing, or commissioning of utility infrastructure and systems
                          2) Non-Technical (Non-Core / Support) Services: Services that support project delivery or business operations`,
              totalBusinessDoneLast5Years: 'Mention total business done in last 5 years with top 5 entities',
              serviceTargetedForLocalization: 'Select “Yes” if the service is currently targeted for localization; otherwise, select “No”'
            }"
      >
        <ng-template
          #itemTemplate
          let-itemControl
          let-index="index"
        >
          <td class="p-3 border border-gray-200 w-[48px] text-center">Service {{ index + 1 }}</td>

          <td class="p-3 border border-gray-200 min-w-[200px]">
            <input
              type="text"
              pInputText
              fluid
              [formControl]="getValueControl(itemControl.get('serviceName'))"
              readonly
              class="text-gray-400"
              [appConditionalColorClass]="highlightInput('serviceName_' + index, itemControl.get('rowId')?.value)"
              [color]="selectedInputColor()"
            />
          </td>

          <td class="p-3 border border-gray-200 min-w-[200px]">
            <app-group-input-with-checkbox
              [hasCommentControl]="getHasCommentControl(itemControl.get('serviceType'))"
              [showCheckbox]="showCheckbox()"
              (valueChanged)="upDateSelectedInputs($event, {
                    section: 'serviceDetails',
                    inputKey: 'serviceType_' + index,
                    label: 'Service Type'
                  }, itemControl.get('rowId')?.value)"
            >
              <p-select
                [options]="serviceTypeOptions()"
                optionLabel="name"
                optionValue="id"
                [formControl]="getValueControl(itemControl.get('serviceType'))"
                placeholder="Select"
                fluid
                [appendTo]="'body'"
                [appConditionalColorClass]="highlightInput('serviceType_' + index, itemControl.get('rowId')?.value)"
                [color]="selectedInputColor()"
              />
            </app-group-input-with-checkbox>
          </td>

          <td class="p-3 border border-gray-200 min-w-[200px]">
            <app-group-input-with-checkbox
              [hasCommentControl]="getHasCommentControl(itemControl.get('serviceCategory'))"
              [showCheckbox]="showCheckbox()"
              (valueChanged)="upDateSelectedInputs($event, {
                    section: 'serviceDetails',
                    inputKey: 'serviceCategory_' + index,
                    label: 'Service Category'
                  }, itemControl.get('rowId')?.value)"
            >
              <p-select
                [options]="serviceCategoryOptions()"
                optionLabel="name"
                optionValue="id"
                [formControl]="getValueControl(itemControl.get('serviceCategory'))"
                placeholder="Select"
                fluid
                [appendTo]="'body'"
                [appConditionalColorClass]="highlightInput('serviceCategory_' + index, itemControl.get('rowId')?.value)"
                [color]="selectedInputColor()"
              />
            </app-group-input-with-checkbox>
          </td>

          <td class="p-3 border border-gray-200 min-w-[250px]">
            <app-group-input-with-checkbox
              [hasCommentControl]="getHasCommentControl(itemControl.get('serviceDescription'))"
              [showCheckbox]="showCheckbox()"
              (valueChanged)="upDateSelectedInputs($event, {
                    section: 'serviceDetails',
                    inputKey: 'serviceDescription_' + index,
                    label: 'Service Description'
                  }, itemControl.get('rowId')?.value)"
            >
              <input
                type="text"
                pInputText
                fluid
                [maxlength]="255"
                placeholder="Brief description of the service"
                [formControl]="getValueControl(itemControl.get('serviceDescription'))"
                [appConditionalColorClass]="highlightInput('serviceDescription_' + index, itemControl.get('rowId')?.value)"
                [color]="selectedInputColor()"
              />
            </app-group-input-with-checkbox>
          </td>

          <td class="p-3 border border-gray-200 min-w-[200px]">
            <app-group-input-with-checkbox
              [hasCommentControl]="getHasCommentControl(itemControl.get('serviceProvidedTo'))"
              [showCheckbox]="showCheckbox()"
              (valueChanged)="upDateSelectedInputs($event, {
                    section: 'serviceDetails',
                    inputKey: 'serviceProvidedTo_' + index,
                    label: 'Service Provided To'
                  }, itemControl.get('rowId')?.value)"
            >
              <p-multiselect
                [options]="serviceProvidedToOptions()"
                optionLabel="name"
                optionValue="id"
                [formControl]="getValueControl(itemControl.get('serviceProvidedTo'))"
                placeholder="Select"
                fluid
                [appendTo]="'body'"
                (onChange)="onServiceProvidedToChange($event.value, index)"
                [appConditionalColorClass]="highlightInput('serviceProvidedTo_' + index, itemControl.get('rowId')?.value)"
                [color]="selectedInputColor()"
              />
            </app-group-input-with-checkbox>

            @if (hasServiceProvidedToOthers(getValueControl(itemControl.get('serviceProvidedTo')).value)) {
            <div class="mt-2">
              <app-group-input-with-checkbox
                [hasCommentControl]="getHasCommentControl(itemControl.get('serviceProvidedToCompanyNames'))"
                [showCheckbox]="showCheckbox()"
                (valueChanged)="upDateSelectedInputs($event, {
                      section: 'serviceDetails',
                      inputKey: 'serviceProvidedToCompanyNames_' + index,
                      label: 'Company Names'
                    }, itemControl.get('rowId')?.value)"
              >
                <textarea
                  pTextarea
                  fluid
                  [maxlength]="255"
                  placeholder="Please mention company names"
                  [formControl]="getValueControl(itemControl.get('serviceProvidedToCompanyNames'))"
                  [appConditionalColorClass]="highlightInput('serviceProvidedToCompanyNames_' + index, itemControl.get('rowId')?.value)"
                  [color]="selectedInputColor()"
                ></textarea>
              </app-group-input-with-checkbox>
              <app-base-error-messages
                [control]="getValueControl(itemControl.get('serviceProvidedToCompanyNames'))"
                [label]="'Company Names'"
              />
              @if (!getValueControl(itemControl.get('serviceProvidedToCompanyNames')).disabled) {
                <div class="text-xs text-gray-500 text-right mt-1">
                  {{ getValueControl(itemControl.get('serviceProvidedToCompanyNames')).value?.length || 0 }} / 255
                </div>
                }
            </div>
            }
          </td>

          <td class="p-3 border border-gray-200 min-w-[200px]">
            <app-group-input-with-checkbox
              [hasCommentControl]="getHasCommentControl(itemControl.get('totalBusinessDoneLast5Years'))"
              [showCheckbox]="showCheckbox()"
              (valueChanged)="upDateSelectedInputs($event, {
                    section: 'serviceDetails',
                    inputKey: 'totalBusinessDoneLast5Years_' + index,
                    label: 'Total Business Done Last 5 Years'
                  }, itemControl.get('rowId')?.value)"
            >
              <textarea
                pTextarea
                fluid
                [maxlength]="150"
                placeholder="Company Name – Amount (Mn SAR) (From Year – To Year)"
                [formControl]="getValueControl(itemControl.get('totalBusinessDoneLast5Years'))"
                [appConditionalColorClass]="highlightInput('totalBusinessDoneLast5Years_' + index, itemControl.get('rowId')?.value)"
                [color]="selectedInputColor()"
              ></textarea>
            </app-group-input-with-checkbox>
            @if (!getValueControl(itemControl.get('totalBusinessDoneLast5Years')).disabled) {
            <div class="text-xs text-gray-500 text-right mt-1">
              {{ getValueControl(itemControl.get('totalBusinessDoneLast5Years')).value?.length || 0 }} / 150
            </div>
            }
          </td>

          <td class="p-3 border border-gray-200 min-w-[150px]">
            <app-group-input-with-checkbox
              [hasCommentControl]="getHasCommentControl(itemControl.get('serviceTargetedForLocalization'))"
              [showCheckbox]="showCheckbox()"
              (valueChanged)="upDateSelectedInputs($event, {
                    section: 'serviceDetails',
                    inputKey: 'serviceTargetedForLocalization_' + index,
                    label: 'Service Targeted For Localization'
                  }, itemControl.get('rowId')?.value)"
            >
              <p-select
                [options]="yesNoOptions()"
                optionLabel="name"
                optionValue="id"
                [formControl]="getValueControl(itemControl.get('serviceTargetedForLocalization'))"
                placeholder="Select"
                fluid
                [appendTo]="'body'"
                (onChange)="onServiceTargetedForLocalizationChange($event.value, index)"
                [appConditionalColorClass]="highlightInput('serviceTargetedForLocalization_' + index, itemControl.get('rowId')?.value)"
                [color]="selectedInputColor()"
              />
            </app-group-input-with-checkbox>
          </td>

          <td class="p-3 border border-gray-200 min-w-[150px]">
            <app-group-input-with-checkbox
              [hasCommentControl]="getHasCommentControl(itemControl.get('expectedLocalizationDate'))"
              [showCheckbox]="showCheckbox()"
              (valueChanged)="upDateSelectedInputs($event, {
                    section: 'serviceDetails',
                    inputKey: 'expectedLocalizationDate_' + index,
                    label: 'Expected Localization Date'
                  }, itemControl.get('rowId')?.value)"
            >
              <p-select
                [options]="availableQuarters()"
                optionLabel="name"
                optionValue="id"
                [formControl]="getValueControl(itemControl.get('expectedLocalizationDate'))"
                placeholder="Select quarter"
                fluid
                [appendTo]="'body'"
                [appConditionalColorClass]="highlightInput('expectedLocalizationDate_' + index, itemControl.get('rowId')?.value)"
                [color]="selectedInputColor()"
              />
            </app-group-input-with-checkbox>
          </td>

          <td class="p-3 border border-gray-200 min-w-[250px]">
            <app-group-input-with-checkbox
              [hasCommentControl]="getHasCommentControl(itemControl.get('serviceLocalizationMethodology'))"
              [showCheckbox]="showCheckbox()"
              (valueChanged)="upDateSelectedInputs($event, {
                    section: 'serviceDetails',
                    inputKey: 'serviceLocalizationMethodology_' + index,
                    label: 'Service Localization Methodology'
                  }, itemControl.get('rowId')?.value)"
            >
              <p-select
                [options]="localizationMethodologyOptions()"
                optionLabel="name"
                optionValue="id"
                [formControl]="getValueControl(itemControl.get('serviceLocalizationMethodology'))"
                placeholder="Select"
                fluid
                [appendTo]="'body'"
                [appConditionalColorClass]="highlightInput('serviceLocalizationMethodology_' + index, itemControl.get('rowId')?.value)"
                [color]="selectedInputColor()"
              />
            </app-group-input-with-checkbox>
          </td>
        </ng-template>
      </app-form-array-input>
    </div>
  </div>

  <app-comment-input
    [commentFormControl]="stepCommentFormControl"
    [commentPhase]="commentPhase()"
  />

  @if(showCheckbox() || showCommentState()){
  <app-comment-state-component
    [commentsCount]="selectedInputs().length"
    [(commentPhase)]="commentPhase"
    [commentFormControl]="commentFormControl"
    [isResubmitMode]="isResubmitMode()"
    [hasInvestorComment]="hasInvestorComment()"
    (deleteComments)="onDeleteComments()"
    (saveComment)="commentPhase() === 'editing' ? onSaveEditedComment() : onSaveComment()"
    (startEditing)="onStartEditing()"
  />
  }

  @if(showDeleteConfirmationDialog()){
  <app-general-confirmation-dialog
    [(visible)]="showDeleteConfirmationDialog"
    [title]="'Are you sure you want to delete the comment and selected fields?'"
    [confirmationLabel]="'Delete'"
    [cancelLabel]="'Cancel'"
    [confirmButtonSeverity]="'danger'"
    [icon]="'icon-trash-2'"
    (confirmed)="onConfirmDeleteComment()"
    (onCancel)="onCancelDeleteComment()"
  />
  }
</div>
