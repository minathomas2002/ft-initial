<div class="flex flex-col gap-[32px] pb-10">

  <div class="flex flex-col gap-4">
    <h2 class="text-lg font-semibold text-gray-900">Company Information</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-1">
      <div class="flex flex-col gap-2 col-span-1">
        <app-base-label [title]="'Plan Title'" />

        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="
            getHasCommentControl(coverPageCompanyInformationFormGroup.get('planTitle'))
          "
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'companyInformation',
            inputKey: 'planTitle',
            label: 'Plan Title'
          })"
        >
          <input
            pInputText
            placeholder="Enter plan title"
            [formControl]="getCoverPageValueControl('planTitle')"
            fluid
            maxlength="150"
            trimOnBlur
            [appConditionalColorClass]="highlightInput('planTitle')"
            [color]="isViewMode() && isFieldCorrected('planTitle', 'companyInformation') ? 'green' : selectedInputColor()"
          />
        </app-group-input-with-checkbox>

        <app-base-error-messages
          [control]="getCoverPageValueControl('planTitle')"
          [label]="'Plan Title'"
        />
      </div>

      <div class="flex flex-col gap-2 col-span-1">
        <app-base-label [title]="'Company Name'" />

        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="
            getHasCommentControl(coverPageCompanyInformationFormGroup.get('companyName'))
          "
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'companyInformation',
            inputKey: 'companyName',
            label: 'Company Name'
          })"
        >
          <input
            pInputText
            placeholder="Enter company name"
            [formControl]="getCoverPageValueControl('companyName')"
            fluid
            maxlength="100"
            trimOnBlur
            [appConditionalColorClass]="highlightInput('companyName')"
            [color]="isViewMode() && isFieldCorrected('companyName', 'companyInformation') ? 'green' : selectedInputColor()"
          />
        </app-group-input-with-checkbox>

        <app-base-error-messages
          [control]="getCoverPageValueControl('companyName')"
          [label]="'Company Name'"
        />
      </div>
    </div>
  </div>

  <div class="flex flex-col gap-4">
    <h2 class="text-lg font-semibold text-gray-900">Services</h2>
    <app-form-array-input
      [ft]="getServicesFormArray()"
      [hideAddButton]="isViewMode()"
      [hideDeleteButton]="isViewMode()"
      [addButtonMessage]="'Add Service'"
      [createNewItem]="createServiceItem"
      [excludeKeys]="['serviceId']"
    >
      <ng-template
        #itemTemplate
        let-itemControl
        let-index="index"
      >
        <td class="p-3 border border-gray-200 min-w-[300px]">
          <app-group-input-with-checkbox
            [hasCommentControl]="getHasCommentControl(itemControl.get('serviceName'))"
            [showCheckbox]="showCheckbox()"
            (valueChanged)="upDateSelectedInputs($event, {
              section: 'services',
              inputKey: 'serviceName_' + index,
              label: 'Service Name'
            }, itemControl.get('rowId')?.value)"
          >
            <input
              type="text"
              pInputText
              fluid
              placeholder="Enter service name"
              [maxlength]="100"
              [formControl]="getValueControl(itemControl.get('serviceName'))"
              trimOnBlur
              [appConditionalColorClass]="highlightInput('serviceName_' + index, itemControl.get('rowId')?.value)"
              [color]="selectedInputColor()"
            />
          </app-group-input-with-checkbox>

          <app-base-error-messages
            [control]="getValueControl(itemControl.get('serviceName'))"
            [label]="'Service Name'"
          />
        </td>
      </ng-template>
    </app-form-array-input>
  </div>

  <app-comment-input
    [commentFormControl]="stepCommentFormControl"
    [commentPhase]="commentPhase()"
  />

  @if(showCheckbox() || showCommentState()){
  <app-comment-state-component
    [commentsCount]="selectedInputs().length"
    [(commentPhase)]="commentPhase"
    [commentFormControl]="commentFormControl"
    [isResubmitMode]="isResubmitMode()"
    [hasInvestorComment]="hasInvestorComment()"
    (deleteComments)="onDeleteComments()"
    (saveComment)="commentPhase() === 'editing' ? onSaveEditedComment() : onSaveComment()"
    (startEditing)="onStartEditing()"
  />
  }

  @if(showDeleteConfirmationDialog()){
  <app-general-confirmation-dialog
    [(visible)]="showDeleteConfirmationDialog"
    [title]="'Are you sure you want to delete the comment and selected fields?'"
    [confirmationLabel]="'Delete'"
    [cancelLabel]="'Cancel'"
    [confirmButtonSeverity]="'danger'"
    [icon]="'icon-trash-2'"
    (confirmed)="onConfirmDeleteComment()"
    (onCancel)="onCancelDeleteComment()"
  />
  }
</div>
