<div class="flex flex-col gap-6 bg-white">
  <!-- Basic Information -->
  <div class="flex flex-col gap-4">
    <app-summary-section-header
      [title]="'Overview'"
      [isViewMode]="isViewMode()"
      (onEdit)="onEditClick()"
    />
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <app-summary-field
        [label]="'Opportunity'"
        [value]="opportunity()"
        [hasError]="hasFieldError('basicInformationFormGroup.opportunity')"
        [hasComment]="opportunityHasComment()"
        [isEmpty]="!opportunity()"
      />
      <app-summary-field
        [label]="'Submission Date'"
        [value]="submissionDate()"
        [isEmpty]="!submissionDate()"
      />
    </div>
  </div>

  <!-- Company Information -->
  <div class="flex flex-col gap-4">
    <h3 class="text-lg font-semibold text-[#4A4E5A]">Company Information</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <app-summary-field
        class="col-span-2"
        [label]="'Company Name'"
        [value]="companyName()"
        [hasError]="hasFieldError('overviewCompanyInformationFormGroup.companyName.value')"
        [hasComment]="companyNameHasComment()"
        [isEmpty]="!companyName()"
        [beforeValue]="getBeforeValue('companyName')"
        [afterValue]="getAfterValue('companyName')"
        [showDiff]="shouldShowDiff('companyName')"
      />
      <app-summary-field
        [label]="'CEO Name'"
        [value]="ceoName()"
        [hasError]="hasFieldError('overviewCompanyInformationFormGroup.ceoName.value')"
        [hasComment]="ceoNameHasComment()"
        [isEmpty]="!ceoName()"
        [beforeValue]="getBeforeValue('ceoName')"
        [afterValue]="getAfterValue('ceoName')"
        [showDiff]="shouldShowDiff('ceoName')"
      />
      <app-summary-field
        [label]="'CEO Email'"
        [value]="ceoEmailID()"
        [hasError]="hasFieldError('overviewCompanyInformationFormGroup.ceoEmailID.value')"
        [hasComment]="ceoEmailIDHasComment()"
        [isEmpty]="!ceoEmailID()"
        [beforeValue]="getBeforeValue('ceoEmailID')"
        [afterValue]="getAfterValue('ceoEmailID')"
        [showDiff]="shouldShowDiff('ceoEmailID')"
      />
    </div>
  </div>

  <!-- Location Information -->
  <div class="flex flex-col gap-4">
    <h3 class="text-lg font-semibold text-[#4A4E5A]">Location Information</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <app-summary-field
        [label]="'Global HQ Location'"
        [value]="globalHQLocation()"
        [hasError]="hasFieldError('locationInformationFormGroup.globalHQLocation.value')"
        [hasComment]="globalHQLocationHasComment()"
        [isEmpty]="!globalHQLocation()"
        [beforeValue]="getBeforeValue('globalHQLocation')"
        [afterValue]="getAfterValue('globalHQLocation')"
        [showDiff]="shouldShowDiff('globalHQLocation')"
      />
      <app-summary-field
        [label]="'Registered Vendor ID with SEC (if available)'"
        [value]="registeredVendorID()"
        [hasError]="hasFieldError('locationInformationFormGroup.registeredVendorIDwithSEC.value')"
        [hasComment]="registeredVendorIDHasComment()"
        [isEmpty]="!registeredVendorID()"
        [beforeValue]="getBeforeValue('registeredVendorIDwithSEC')"
        [afterValue]="getAfterValue('registeredVendorIDwithSEC')"
        [showDiff]="shouldShowDiff('registeredVendorIDwithSEC')"
      />
      <app-summary-field
        [label]="'BENA Registered Vendor ID (Required)'"
        [value]="benaRegisteredVendorID()"
        [hasError]="hasFieldError('locationInformationFormGroup.benaRegisteredVendorID.value')"
        [hasComment]="benaRegisteredVendorIDHasComment()"
        [isEmpty]="!benaRegisteredVendorID()"
        [beforeValue]="getBeforeValue('benaRegisteredVendorID')"
        [afterValue]="getAfterValue('benaRegisteredVendorID')"
        [showDiff]="shouldShowDiff('benaRegisteredVendorID')"
      />
      <app-summary-field
        [label]="'Do you currently have local Agent in KSA?'"
        [value]="hasLocalAgent()"
        [isBoolean]="true"
        [hasError]="hasFieldError('locationInformationFormGroup.doYouCurrentlyHaveLocalAgentInKSA')"
        [hasComment]="hasLocalAgentHasComment()"
        [isEmpty]="hasLocalAgent() === null"
        [beforeValue]="getBeforeValue('doYouCurrentlyHaveLocalAgentInKSA')"
        [afterValue]="getAfterValue('doYouCurrentlyHaveLocalAgentInKSA')"
        [showDiff]="shouldShowDiff('doYouCurrentlyHaveLocalAgentInKSA')"
      />
    </div>

    @if (hasLocalAgent() === true) {
    <div class="flex flex-col gap-4">
      <h4 class="text-lg font-semibold text-gray-700">Local Agent Information</h4>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <app-summary-field
          class="col-span-2"
          [label]="'Local Agent Details'"
          [value]="localAgentDetails()"
          [hasError]="hasFieldError('localAgentInformationFormGroup.localAgentDetails.value')"
          [hasComment]="localAgentDetailsHasComment()"
          [isEmpty]="!localAgentDetails()"
          [beforeValue]="getBeforeValue('localAgentDetails')"
          [afterValue]="getAfterValue('localAgentDetails')"
          [showDiff]="shouldShowDiff('localAgentDetails')"
        />
        <app-summary-field
          [label]="'Local Agent Name'"
          [value]="localAgentName()"
          [hasError]="hasFieldError('localAgentInformationFormGroup.localAgentName.value')"
          [hasComment]="localAgentNameHasComment()"
          [isEmpty]="!localAgentName()"
          [beforeValue]="getBeforeValue('localAgentName')"
          [afterValue]="getAfterValue('localAgentName')"
          [showDiff]="shouldShowDiff('localAgentName')"
        />
        <app-summary-field
          [label]="'Contact Person Name'"
          [value]="contactPersonName()"
          [hasError]="hasFieldError('localAgentInformationFormGroup.contactPersonName.value')"
          [hasComment]="contactPersonNameHasComment()"
          [isEmpty]="!contactPersonName()"
          [beforeValue]="getBeforeValue('contactPersonName')"
          [afterValue]="getAfterValue('contactPersonName')"
          [showDiff]="shouldShowDiff('contactPersonName')"
        />
        <app-summary-field
          [label]="'Email ID'"
          [value]="emailID()"
          [hasError]="hasFieldError('localAgentInformationFormGroup.emailID.value')"
          [hasComment]="emailIDHasComment()"
          [isEmpty]="!emailID()"
          [beforeValue]="getBeforeValue('emailID')"
          [afterValue]="getAfterValue('emailID')"
          [showDiff]="shouldShowDiff('emailID')"
        />
        <app-summary-field
          [label]="'Contact Number'"
          [value]="contactNumber()"
          [hasError]="hasFieldError('localAgentInformationFormGroup.contactNumber.value')"
          [hasComment]="contactNumberHasComment()"
          [isEmpty]="!contactNumber()"
          [beforeValue]="getBeforeValue('contactNumber')"
          [afterValue]="getAfterValue('contactNumber')"
          [showDiff]="shouldShowDiff('contactNumber')"
        />
        <app-summary-field
          [label]="'Company HQ Location'"
          [value]="companyLocation()"
          [hasError]="hasFieldError('localAgentInformationFormGroup.companyLocation.value')"
          [hasComment]="companyLocationHasComment()"
          [isEmpty]="!companyLocation()"
          [beforeValue]="getBeforeValue('companyLocation')"
          [afterValue]="getAfterValue('companyLocation')"
          [showDiff]="shouldShowDiff('companyLocation')"
        />
      </div>
    </div>
    }
  </div>

  <!-- Service Details -->
  <div class="flex flex-col gap-4">
    <h3 class="text-lg font-semibold text-[#4A4E5A]">Details of Service Provided</h3>
    <div class="overflow-x-auto">
      <div class="rounded-2xl border border-gray-300">
        <p-table
          [value]="serviceDetails()"
          [tableStyle]="{ 'border-collapse': 'collapse', width: '100%' }"
          styleClass="w-full [&_th]:!border-e [&_td]:!border-e [&_th]:!border-gray-300 [&_td]:!border-gray-300"
        >
          <ng-template pTemplate="header">
            <tr class="[&_th]:bg-[#F9FAFA]! [&_th]:text-[#4A4E5A]!">
              <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A] min-w-[150px]"># of Services</th>
              <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A] min-w-[220px]">Service Name</th>
              <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A] min-w-[150px]">Service Type</th>
              <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A] min-w-[150px]">Service Category</th>
              <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A] min-w-[360px]">Service Description</th>
              <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A] min-w-[220px]">Service Provided to</th>
              <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A] min-w-[240px]">Total Business Done (Last 5 Years)</th>
              <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A] min-w-[160px]">Targeted for Localization</th>
              <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A] min-w-[160px]">Expected Localization Date</th>
              <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A] min-w-[260px]">Service Localization Methodology</th>
            </tr>
          </ng-template>

          <ng-template
            pTemplate="body"
            let-service
            let-rowIndex="rowIndex"
          >
            <tr>
              <td class="border-t border-gray-300 p-4">{{ rowIndex + 1 }}</td>

              <td class="border-t border-gray-300 p-4 min-w-[220px]">
                <app-summary-table-cell
                  [value]="service.serviceName"
                  [isEmpty]="!service.serviceName"
                  [hasError]="hasServiceDetailFieldError(rowIndex, 'serviceName')"
                  [hasComment]="hasServiceDetailComment(rowIndex, 'serviceName')"
                  [beforeValue]="getBeforeValue('serviceName', rowIndex)"
                  [afterValue]="getAfterValue('serviceName', rowIndex)"
                  [showDiff]="shouldShowDiff('serviceName', rowIndex)"
                />
              </td>

              <td class="border-t border-gray-300 p-4 min-w-[400px]">
                <app-summary-table-cell
                  [value]="service.serviceType"
                  [isEmpty]="!service.serviceType"
                  [hasError]="hasServiceDetailFieldError(rowIndex, 'serviceType')"
                  [hasComment]="hasServiceDetailComment(rowIndex, 'serviceType')"
                  [beforeValue]="getBeforeValue('serviceType', rowIndex)"
                  [afterValue]="getAfterValue('serviceType', rowIndex)"
                  [showDiff]="shouldShowDiff('serviceType', rowIndex)"
                />
              </td>

              <td class="border-t border-gray-300 p-4">
                <app-summary-table-cell
                  [value]="service.serviceCategory"
                  [isEmpty]="!service.serviceCategory"
                  [hasError]="hasServiceDetailFieldError(rowIndex, 'serviceCategory')"
                  [hasComment]="hasServiceDetailComment(rowIndex, 'serviceCategory')"
                  [beforeValue]="getBeforeValue('serviceCategory', rowIndex)"
                  [afterValue]="getAfterValue('serviceCategory', rowIndex)"
                  [showDiff]="shouldShowDiff('serviceCategory', rowIndex)"
                />
              </td>

              <td class="border-t border-gray-300 p-4 min-w-[360px]">
                <app-summary-table-cell
                  [value]="service.serviceDescription"
                  [isEmpty]="!service.serviceDescription"
                  [hasError]="hasServiceDetailFieldError(rowIndex, 'serviceDescription')"
                  [hasComment]="hasServiceDetailComment(rowIndex, 'serviceDescription')"
                  [beforeValue]="getBeforeValue('serviceDescription', rowIndex)"
                  [afterValue]="getAfterValue('serviceDescription', rowIndex)"
                  [showDiff]="shouldShowDiff('serviceDescription', rowIndex)"
                />
              </td>

              <td class="border-t border-gray-300 p-4 min-w-[400px]">
                <app-summary-table-cell
                  [value]="service.serviceProvidedTo"
                  [isEmpty]="!service.serviceProvidedTo"
                  [hasError]="hasServiceDetailFieldError(rowIndex, 'serviceProvidedTo')"
                  [hasComment]="hasServiceDetailComment(rowIndex, 'serviceProvidedTo')"
                  [beforeValue]="getBeforeValue('serviceProvidedTo', rowIndex)"
                  [afterValue]="getAfterValue('serviceProvidedTo', rowIndex)"
                  [showDiff]="shouldShowDiff('serviceProvidedTo', rowIndex)"
                />
              </td>

              <td class="border-t border-gray-300 p-4 min-w-[400px]">
                <app-summary-table-cell
                  [value]="service.totalBusinessDoneLast5Years"
                  [isEmpty]="!service.totalBusinessDoneLast5Years"
                  [hasError]="hasServiceDetailFieldError(rowIndex, 'totalBusinessDoneLast5Years')"
                  [hasComment]="hasServiceDetailComment(rowIndex, 'totalBusinessDoneLast5Years')" 
                  [beforeValue]="getBeforeValue('totalBusinessDoneLast5Years', rowIndex)"
                  [afterValue]="getAfterValue('totalBusinessDoneLast5Years', rowIndex)"
                  [showDiff]="shouldShowDiff('totalBusinessDoneLast5Years', rowIndex)"
                />
              </td>

              <td class="border-t border-gray-300 p-4">
                <app-summary-table-cell
                  [value]="service.serviceTargetedForLocalization"
                  [isBoolean]="true"
                  [isEmpty]="!service.serviceTargetedForLocalization"
                  [hasError]="hasServiceDetailFieldError(rowIndex, 'serviceTargetedForLocalization')"
                  [hasComment]="hasServiceDetailComment(rowIndex, 'serviceTargetedForLocalization')"
                  [beforeValue]="getBeforeValue('serviceTargetedForLocalization', rowIndex)"
                  [afterValue]="getAfterValue('serviceTargetedForLocalization', rowIndex)"
                  [showDiff]="shouldShowDiff('serviceTargetedForLocalization', rowIndex)"
                />
              </td>

              <td class="border-t border-gray-300 p-4">
                <app-summary-table-cell
                  [value]="service.expectedLocalizationDate"
                  [isEmpty]="!service.expectedLocalizationDate"
                  [hasError]="hasServiceDetailFieldError(rowIndex, 'expectedLocalizationDate')"
                  [hasComment]="hasServiceDetailComment(rowIndex, 'expectedLocalizationDate')"
                  [beforeValue]="getBeforeValue('expectedLocalizationDate', rowIndex)"
                  [afterValue]="getAfterValue('expectedLocalizationDate', rowIndex)"
                  [showDiff]="shouldShowDiff('expectedLocalizationDate', rowIndex)"
                />
              </td>

              <td class="border-t border-gray-300 p-4">
                <app-summary-table-cell
                  [value]="service.serviceLocalizationMethodology"
                  [isEmpty]="!service.serviceLocalizationMethodology"
                  [hasError]="hasServiceDetailFieldError(rowIndex, 'serviceLocalizationMethodology')"
                  [hasComment]="hasServiceDetailComment(rowIndex, 'serviceLocalizationMethodology')"

                  [beforeValue]="getBeforeValue('serviceLocalizationMethodology', rowIndex)"
                  [afterValue]="getAfterValue('serviceLocalizationMethodology', rowIndex)"
                  [showDiff]="shouldShowDiff('serviceLocalizationMethodology', rowIndex)"
                />
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>