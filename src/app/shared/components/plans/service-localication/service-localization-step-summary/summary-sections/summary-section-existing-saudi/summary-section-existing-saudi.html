<div class="flex flex-col gap-6 bg-white">
  <!-- Section Header -->
  <div class="flex flex-col gap-4">
    <app-summary-section-header
      [title]="'Existing Saudi Co.'"
      [isViewMode]="isViewMode()"
      (onEdit)="onEditClick()"
    />

    <!-- Saudi Company Details -->
    <div class="flex flex-col gap-4">
      <h3 class="text-lg font-semibold text-[#4A4E5A]">Saudi Company Details</h3>
        <div class="overflow-x-auto">
          <div class="rounded-lg overflow-hidden border border-gray-300">
            <p-table
              [value]="saudiCompanyDetails()"
              [tableStyle]="{ 'border-collapse': 'collapse', width: '100%' }"
              styleClass="w-full [&_th]:!border [&_td]:!border [&_th]:!border-gray-300 [&_td]:!border-gray-300"
            >
              <ng-template pTemplate="header">
                <tr class="[&_th]:bg-[#F9FAFA]! [&_th]:text-[#4A4E5A]!">
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Saudi Company Name</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Vendor ID with SEC</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Bena Vendor ID</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Company Type</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Qualification Status</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Product(s)</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Company Overview</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Key Projects Executed</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Company Overview Key Project Details</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Company Overview (Other)</th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-company let-rowIndex="rowIndex">
                <tr>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="company.saudiCompanyName"
                      [isEmpty]="!company.saudiCompanyName"
                      [hasError]="hasSaudiCompanyFieldError(rowIndex, 'saudiCompanyName')"
                      [hasComment]="hasSaudiCompanyComment(rowIndex, 'saudiCompanyName')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="company.registeredVendorIDwithSEC"
                      [isEmpty]="!company.registeredVendorIDwithSEC"
                      [hasError]="hasSaudiCompanyFieldError(rowIndex, 'registeredVendorIDwithSEC')"
                      [hasComment]="hasSaudiCompanyComment(rowIndex, 'registeredVendorIDwithSEC')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="company.benaRegisteredVendorID"
                      [isEmpty]="!company.benaRegisteredVendorID"
                      [hasError]="hasSaudiCompanyFieldError(rowIndex, 'benaRegisteredVendorID')"
                      [hasComment]="hasSaudiCompanyComment(rowIndex, 'benaRegisteredVendorID')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="formatCompanyType(company.companyType)"
                      [isEmpty]="!formatCompanyType(company.companyType)"
                      [hasError]="hasSaudiCompanyFieldError(rowIndex, 'companyType')"
                      [hasComment]="hasSaudiCompanyComment(rowIndex, 'companyType')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="formatQualificationStatus(company.qualificationStatus)"
                      [isEmpty]="!formatQualificationStatus(company.qualificationStatus)"
                      [hasError]="hasSaudiCompanyFieldError(rowIndex, 'qualificationStatus')"
                      [hasComment]="hasSaudiCompanyComment(rowIndex, 'qualificationStatus')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="company.products"
                      [isEmpty]="!company.products"
                      [hasError]="hasSaudiCompanyFieldError(rowIndex, 'products')"
                      [hasComment]="hasSaudiCompanyComment(rowIndex, 'products')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="company.companyOverview"
                      [isEmpty]="!company.companyOverview"
                      [hasError]="hasSaudiCompanyFieldError(rowIndex, 'companyOverview')"
                      [hasComment]="hasSaudiCompanyComment(rowIndex, 'companyOverview')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="company.keyProjectsExecutedByContractorForSEC"
                      [isEmpty]="!company.keyProjectsExecutedByContractorForSEC"
                      [hasError]="hasSaudiCompanyFieldError(rowIndex, 'keyProjectsExecutedByContractorForSEC')"
                      [hasComment]="hasSaudiCompanyComment(rowIndex, 'keyProjectsExecutedByContractorForSEC')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="company.companyOverviewKeyProjectDetails"
                      [isEmpty]="!company.companyOverviewKeyProjectDetails"
                      [hasError]="hasSaudiCompanyFieldError(rowIndex, 'companyOverviewKeyProjectDetails')"
                      [hasComment]="hasSaudiCompanyComment(rowIndex, 'companyOverviewKeyProjectDetails')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="company.companyOverviewOther"
                      [isEmpty]="!company.companyOverviewOther"
                      [hasError]="hasSaudiCompanyFieldError(rowIndex, 'companyOverviewOther')"
                      [hasComment]="hasSaudiCompanyComment(rowIndex, 'companyOverviewOther')"
                    />
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>

    </div>

    <!-- Collaboration/Partnership -->
    <div class="flex flex-col gap-4">
      <h3 class="text-lg font-semibold text-[#4A4E5A]">Details on Collaboration / Partnership model</h3>
        <div class="overflow-x-auto">
          <div class="rounded-lg overflow-hidden border border-gray-300">
            <p-table
              [value]="collaborationPartnership()"
              [tableStyle]="{ 'border-collapse': 'collapse', width: '100%' }"
              styleClass="w-full [&_th]:!border [&_td]:!border [&_th]:!border-gray-300 [&_td]:!border-gray-300"
            >
              <ng-template pTemplate="header">
                <tr class="[&_th]:bg-[#F9FAFA]! [&_th]:text-[#4A4E5A]!">
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Agreement Type</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">If Agreement Type is "Other", provide details</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Agreement Signing Date</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Supervision/Oversight Entity</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Why Chose This Company</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Summary of Key Agreement Clauses</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]">Provide Agreement Copy</th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-partner let-rowIndex="rowIndex">
                <tr>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="partner.agreementType"
                      [isEmpty]="!partner.agreementType"
                      [hasError]="hasCollaborationFieldError(rowIndex, 'agreementType')"
                      [hasComment]="hasCollaborationComment(rowIndex, 'agreementType')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="partner.agreementOtherDetails"
                      [isEmpty]="!partner.agreementOtherDetails"
                      [hasError]="hasCollaborationFieldError(rowIndex, 'agreementOtherDetails')"
                      [hasComment]="hasCollaborationComment(rowIndex, 'agreementOtherDetails')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="partner.agreementSigningDate"
                      [isEmpty]="!partner.agreementSigningDate"
                      [hasError]="hasCollaborationFieldError(rowIndex, 'agreementSigningDate')"
                      [hasComment]="hasCollaborationComment(rowIndex, 'agreementSigningDate')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="partner.supervisionOversight"
                      [isEmpty]="!partner.supervisionOversight"
                      [hasError]="hasCollaborationFieldError(rowIndex, 'supervisionOversightEntity')"
                      [hasComment]="hasCollaborationComment(rowIndex, 'supervisionOversightEntity')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="partner.whyChoseThisCompany"
                      [isEmpty]="!partner.whyChoseThisCompany"
                      [hasError]="hasCollaborationFieldError(rowIndex, 'whyChoseThisCompany')"
                      [hasComment]="hasCollaborationComment(rowIndex, 'whyChoseThisCompany')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="partner.summaryOfKeyAgreementClauses"
                      [isEmpty]="!partner.summaryOfKeyAgreementClauses"
                      [hasError]="hasCollaborationFieldError(rowIndex, 'summaryOfKeyAgreementClauses')"
                      [hasComment]="hasCollaborationComment(rowIndex, 'summaryOfKeyAgreementClauses')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="partner.provideAgreementCopy"
                      [isEmpty]="partner.provideAgreementCopy === null || partner.provideAgreementCopy === undefined"
                      [hasError]="hasCollaborationFieldError(rowIndex, 'provideAgreementCopy')"
                      [hasComment]="hasCollaborationComment(rowIndex, 'provideAgreementCopy')"
                    />
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
    </div>

    <!-- Entity Level -->
    @if (entityLevel()) {
      <div class="flex flex-col gap-4">
        <h3 class="text-lg font-semibold text-[#4A4E5A]">Entity Level (i.e., local conpany responsible for delivering the services)</h3>
        <p class="text-sm font-normal text-[#4A4E5A]">Details to be provided for the KSA facility only considering only the workforce / employees directly responsible for delivering all the services you intend to localize by setting up local entity / branch / other</p>
        <div class="overflow-x-auto">
          <div class="rounded-lg overflow-hidden border border-gray-300">
            <p-table
              [value]="entityLevel() ? [entityLevel()!] : []"
              [tableStyle]="{ 'border-collapse': 'collapse', width: '100%' }"
              styleClass="w-full [&_th]:!border [&_td]:!border [&_th]:!border-gray-300 [&_td]:!border-gray-300"
            >
              <ng-template pTemplate="header">
                <tr class="bg-primary">
                  <th class="p-3 text-start text-sm font-medium text-white" colspan="5">
                    Expected Annual Headcount (upto {{yearColumns()[yearColumns().length - 1]}})
                    <span class="font-normal text-xs">(To be filled for the KSA based facility only)</span>
                  </th>
                </tr>
                <tr class="[&_th]:bg-[#F9FAFA]! [&_th]:text-[#4A4E5A]!">
                  @for (year of yearColumns(); track $index) {
                    <th class="p-3 text-start text-sm font-medium text-[#4A4E5A]">{{ year }}</th>
                  }
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-row>
                <tr>
                  @for (headcount of row.headcount; track $index) {
                    <td class="border-t border-gray-300 p-3 text-center">
                      <app-summary-table-cell
                        [value]="headcount.value"
                        [isEmpty]="!headcount.value && headcount.value !== 0"
                        [hasError]="hasEntityFieldError(headcount.controlName)"
                        [hasComment]="hasEntityLevelComment(headcount.controlName)"
                      />
                    </td>
                  }
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>
    }

    <!-- Service Level -->
    <div class="flex flex-col gap-4">
      <h3 class="text-lg font-semibold text-[#4A4E5A]">Service Level</h3>
      @if (serviceLevel().length > 0) {
        <div class="overflow-x-auto">
          <div class="rounded-lg overflow-hidden border border-gray-300">
            <p-table
              [value]="serviceLevel()"
              [tableStyle]="{ 'border-collapse': 'collapse', width: '100%' }"
              styleClass="w-full [&_th]:min-w-[150px] [&_th]:!border [&_td]:!border [&_th]:!border-gray-300 [&_td]:!border-gray-300"
              [scrollable]="true"
            >
              <ng-template pTemplate="header">
                <tr class="[&>th:not([data-group])]:bg-[#F9FAFA]! [&>th:not([data-group])]:text-[#4A4E5A]!">
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]" rowspan="2">Service Name</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]" rowspan="2">Expected Localization Date</th>
                  <th class="p-3 text-center text-sm font-semibold bg-primary! text-white!" colspan="5" data-group="true">Expected Annual Headcount (To be filled for the KSA based facility only)</th>
                  <th class="p-3 text-center text-sm font-semibold bg-primary! text-white!" colspan="5" data-group="true">Mention Y-o-Y expected Saudization % (To be filled for the KSA based facility only)</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]" rowspan="2">Key Measures to Upskill Saudis</th>
                  <th class="p-3 text-left text-sm font-semibold text-[#4A4E5A]" rowspan="2">Support Required from SEC</th>
                </tr>
                <tr class="[&_th]:bg-[#F9FAFA]! [&_th]:text-[#4A4E5A]!">
                  @for (year of yearColumns(); track $index) {
                    <th class="p-3 text-center text-sm font-semibold text-[#4A4E5A]">{{ year }}</th>
                  }
                  @for (year of yearColumns(); track $index) {
                    <th class="p-3 text-center text-sm font-semibold text-[#4A4E5A]">{{ year }}</th>
                  }
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-service>
                <tr>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="service.serviceName"
                      [isEmpty]="!service.serviceName"
                      [hasError]="hasServiceLevelFieldError(service.index, 'serviceName')"
                      [hasComment]="hasServiceLevelComment(service.index, 'serviceName')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="service.expectedLocalizationDate"
                      [isEmpty]="!service.expectedLocalizationDate"
                      [hasError]="hasServiceLevelFieldError(service.index, 'expectedLocalizationDate')"
                      [hasComment]="hasServiceLevelComment(service.index, 'expectedLocalizationDate')"
                    />
                  </td>
                  @for (yearCell of service.headcountYears; track $index) {
                    <td class="border-t border-gray-300 p-3 text-center">
                      <app-summary-table-cell
                        [value]="yearCell.value"
                        [isEmpty]="!yearCell.value && yearCell.value !== 0"
                        [hasError]="hasServiceLevelFieldError(service.index, yearCell.controlName)"
                        [hasComment]="hasServiceLevelComment(service.index, yearCell.controlName)"
                      />
                    </td>
                  }
                  @for (year of service.years; track $index) {
                    <td class="border-t border-gray-300 p-3 text-center">
                      <app-summary-table-cell
                        [value]="year.value"
                        [isEmpty]="!year.value && year.value !== 0"
                        [hasError]="hasServiceLevelFieldError(service.index, year.controlName)"
                        [hasComment]="hasServiceLevelComment(service.index, year.controlName)"
                      />
                    </td>
                  }
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="service.keyMeasuresToUpskillSaudis"
                      [isEmpty]="!service.keyMeasuresToUpskillSaudis"
                      [hasError]="hasServiceLevelFieldError(service.index, 'keyMeasuresToUpskillSaudis')"
                      [hasComment]="hasServiceLevelComment(service.index, 'keyMeasuresToUpskillSaudis')"
                    />
                  </td>
                  <td class="border-t border-gray-300 p-3">
                    <app-summary-table-cell
                      [value]="service.mentionSupportRequiredFromSEC"
                      [isEmpty]="!service.mentionSupportRequiredFromSEC"
                      [hasError]="hasServiceLevelFieldError(service.index, 'mentionSupportRequiredFromSEC')"
                      [hasComment]="hasServiceLevelComment(service.index, 'mentionSupportRequiredFromSEC')"
                    />
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      } @else {
        <p class="text-sm text-gray-500">No service level details added</p>
      }
    </div>

    <!-- Attachments -->
    <div class="flex flex-col gap-4">
      <h3 class="text-lg font-semibold text-[#4A4E5A]">Attachments</h3>
      @if (hasAttachmentsError()) {
        <span class="text-sm text-red-600">Attachments is required</span>
      }
      @if (attachments().length > 0) {
        <div class="flex flex-col gap-2">
          @for (file of attachments(); track $index) {
            <div class="flex items-center gap-2 text-sm text-gray-700">
              <i class="icon-file"></i>
              <span>{{ file.name }}</span>
            </div>
          }
        </div>
      } @else {
        <p class="text-sm text-gray-500">No attachments</p>
      }
    </div>
  </div>
</div>
