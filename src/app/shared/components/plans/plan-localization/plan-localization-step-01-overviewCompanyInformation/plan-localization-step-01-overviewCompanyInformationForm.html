<div class="flex flex-col gap-[32px]">
  <!-- Basic Information -->
  <div class="flex flex-col gap-4">
    <h2 class="text-lg font-semibold text-gray-900">Basic Information <span><i
          class="icon-info text-sm ms-2 text-gray-400"
          pTooltip="Supplier contact information provided here will serve as the primary contact for SEC throughout the entire BENA program."
          tooltipPosition="top"
          [tooltipStyleClass]="'min-w-[300px]'"
        ></i></span></h2>
    <div class="flex flex-col gap-4 md:flex-row">
      <div class="flex flex-col gap-2 flex-1">
        <app-base-label [title]="'plans.newPlan.planTitle' | translate" />
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="getHasCommentControl(basicInformationFormGroupControls['planTitle'])"
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'basicInformation',
            inputKey: 'planTitle',
            label: 'Plan Title'
          })"
        >
          <input
            type="text"
            pInputText
            placeholder="Enter your plan title"
            [formControl]="getValueControl(basicInformationFormGroupControls['planTitle'])"
            fluid
            maxlength="150"
            [appConditionalColorClass]="highlightInput('planTitle')"
            [color]="selectedInputColor()"
          />
        </app-group-input-with-checkbox>
        <app-base-error-messages
          [control]="getValueControl(basicInformationFormGroupControls['planTitle'])"
          [label]="'plans.newPlan.planTitle' | translate"
        />
      </div>
      <div class="flex flex-col gap-2 flex-1">
        <app-base-label [title]="'plans.newPlan.opportunityType' | translate" />
        <p-select
          [options]="opportunityTypes"
          [formControl]="getFormControl(basicInformationFormGroupControls['opportunityType'])"
          optionLabel="name"
          optionValue="id"
          fluid
        >
          <ng-template
            pTemplate="item"
            let-item
          >
            {{ item.name | translate }}
          </ng-template>
          <ng-template
            pTemplate="selectedItem"
            let-item
          >
            {{ item.name | translate }}
          </ng-template>
        </p-select>
      </div>
    </div>
    <div class="flex flex-col gap-4 md:flex-row">
      <div class="flex flex-col gap-2 flex-1">
        <app-base-label [title]="'Opportunity'" />
        <p-select
          [options]="availableOpportunities()"
          [formControl]="getFormControl(basicInformationFormGroupControls['opportunity'])"
          optionLabel="name"
          placeholder="Select opportunity"
          [loading]="isLoadingAvailableOpportunities()"
          [disabled]="isOpportunityDisabled()"
          fluid
        />
        <app-base-error-messages
          [control]="getFormControl(basicInformationFormGroupControls['opportunity'])"
          [label]="'plans.newPlan.opportunity' | translate"
        />
      </div>
      <div class="flex flex-col gap-2 flex-1">
        <app-base-label [title]="'Submission Date'" />
        <p-datepicker
          fluid
          dateFormat="dd M yy"
          [formControl]="getFormControl(basicInformationFormGroupControls['submissionDate'])"
        />
      </div>
    </div>
  </div>

  <!-- Company Information -->
  <div class="flex flex-col gap-4">
    <h2 class="text-lg font-semibold text-gray-900">Company Information</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-1 ">
      <div class="flex flex-col gap-2 col-span-1">
        <app-base-label [title]="'Company Name'" />
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="companyNameHasCommentControl()!"
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'companyInformation',
            inputKey: 'companyName',
            label: 'Company Name'
          })"
        >
          <input
            type="text"
            pInputText
            fluid
            [maxlength]="100"
            placeholder="Enter company name"
            [formControl]="getValueControl(companyInformationFormGroupControls['companyName'])"
            [appConditionalColorClass]="highlightInput('companyName')"
            [color]="selectedInputColor()"
          />
        </app-group-input-with-checkbox>
        <app-base-error-messages
          [control]="getValueControl(companyInformationFormGroupControls['companyName'])"
          [label]="'Company Name'"
        />
      </div>
    </div>
    <div class="flex flex-col gap-4 md:flex-row">
      <div class="flex flex-col gap-2 flex-1">
        <app-base-label [title]="'CEO Name'" />
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="getHasCommentControl(companyInformationFormGroupControls['ceoName'])"
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'companyInformation',
            inputKey: 'ceoName',
            label: 'CEO Name'
          })"
        >
          <input
            type="text"
            pInputText
            fluid
            placeholder="Enter CEO name"
            [maxlength]="100"
            [formControl]="getValueControl(companyInformationFormGroupControls['ceoName'])"
            [appConditionalColorClass]="highlightInput('ceoName')"
            [color]="selectedInputColor()"
          />
        </app-group-input-with-checkbox>
        <app-base-error-messages
          [control]="getValueControl(companyInformationFormGroupControls['ceoName'])"
          [label]="'CEO Name'"
        />
      </div>
      <div class="flex flex-col gap-2 flex-1">
        <app-base-label [title]="'CEO Email'" />
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="getHasCommentControl(companyInformationFormGroupControls['ceoEmailID'])"
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'companyInformation',
            inputKey: 'ceoEmailID',
            label: 'CEO Email'
          })"
        >
          <input
            type="email"
            pInputText
            fluid
            placeholder="Enter CEO email ID"
            maxlength="100"
            [appConditionalColorClass]="highlightInput('ceoEmailID')"
            [color]="selectedInputColor()"
            [formControl]="getValueControl(companyInformationFormGroupControls['ceoEmailID'])"
          />
        </app-group-input-with-checkbox>
        <app-base-error-messages
          [control]="getValueControl(companyInformationFormGroupControls['ceoEmailID'])"
          [label]="'CEO Email'"
        />
      </div>
    </div>
  </div>

  <!-- Location Information -->
  <div class="flex flex-col gap-4">
    <h2 class="text-lg font-semibold text-gray-900">Location Information</h2>
    <div class="flex flex-col gap-4 md:flex-row">
      <div class="flex flex-col gap-2 flex-1">
        <app-base-label [title]="'Global HQ Location'" />
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="getHasCommentControl(locationInformationFormGroupControls['globalHQLocation'])"
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'locationInformation',
            inputKey: 'globalHQLocation',
            label: 'Global HQ Location'
          })"
        >
          <input
            type="text"
            pInputText
            fluid
            placeholder="Enter global HQ location"
            [maxlength]="255"
            [formControl]="getValueControl(locationInformationFormGroupControls['globalHQLocation'])"
            [appConditionalColorClass]="highlightInput('globalHQLocation')"
            [color]="selectedInputColor()"
          />
        </app-group-input-with-checkbox>
        <app-base-error-messages
          [control]="getValueControl(locationInformationFormGroupControls['globalHQLocation'])"
          [label]="'Global HQ Location'"
        />
      </div>
      <div class="flex flex-col gap-2 flex-1">
        <div>
          <app-base-label [title]="'Registered Vendor ID with SEC'" />
          <span class="text-sm text-gray-600 ms-2">(If available)</span>
        </div>
        <app-group-input-with-checkbox
          [showCheckbox]="showCheckbox()"
          [hasCommentControl]="getHasCommentControl(locationInformationFormGroupControls['registeredVendorIDwithSEC'])"
          (valueChanged)="upDateSelectedInputs($event, {
            section: 'locationInformation',
            inputKey: 'registeredVendorIDwithSEC',
            label: 'Registered Vendor ID with SEC'
          })"
        >
          <p-inputnumber
            [useGrouping]="false"
            [minFractionDigits]="0"
            [maxFractionDigits]="0"
            [allowEmpty]="true"
            mode="decimal"
            type="text"
            fluid
            placeholder="Enter registered vendor ID with SEC"
            [maxlength]="7"
            [formControl]="getValueControl(locationInformationFormGroupControls['registeredVendorIDwithSEC'])"
            [appConditionalColorClass]="highlightInput('registeredVendorIDwithSEC')"
            [color]="selectedInputColor()"
          />
        </app-group-input-with-checkbox>

        <app-base-error-messages
          [control]="getValueControl(locationInformationFormGroupControls['registeredVendorIDwithSEC'])"
          [label]="'Registered Vendor ID with SEC'"
        />
      </div>
    </div>
    <div class="flex flex-col gap-4 md:flex-row">
      <div class="flex flex-col gap-2 flex-1">
        <div>
          <h4 class="text-sm font-medium text-gray-900">Do you currently have local Agent in KSA?</h4>
          <p class="text-sm text-gray-600">If “Yes”, mention the following details of Local Agent - </p>
        </div>
        <div class="flex gap-2">
          <app-group-input-with-checkbox
            [showCheckbox]="showCheckbox()"
            [hasCommentControl]="getHasCommentControl(locationInformationFormGroupControls['doYouCurrentlyHaveLocalAgentInKSA'])"
            (valueChanged)="upDateSelectedInputs($event, {
              section: 'locationInformation',
              inputKey: 'doYouCurrentlyHaveLocalAgentInKSA',
              label: 'Do you currently have local Agent in KSA?'
            })"
          >
            <div class="flex gap-2">
              <label class="flex items-center gap-2 cursor-pointer">
                <p-radiobutton
                  name="doYouCurrentlyHaveLocalAgentInKSA"
                  [value]="true"
                  [formControl]="getFormControl(locationInformationFormGroupControls['doYouCurrentlyHaveLocalAgentInKSA'])"
                  inputId="doYouCurrentlyHaveLocalAgentInKSAYes"
                  size="small"
                  [appConditionalColorClass]="highlightInput('doYouCurrentlyHaveLocalAgentInKSA')"
                  [color]="selectedInputColor()"
                />
                <span class="min-w-[100px] text-sm text-gray-700 font-medium">Yes</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <p-radiobutton
                  name="doYouCurrentlyHaveLocalAgentInKSA"
                  [value]="false"
                  [formControl]="getFormControl(locationInformationFormGroupControls['doYouCurrentlyHaveLocalAgentInKSA'])"
                  inputId="doYouCurrentlyHaveLocalAgentInKSANo"
                  size="small"
                  [appConditionalColorClass]="highlightInput('doYouCurrentlyHaveLocalAgentInKSA')"
                  [color]="selectedInputColor()"
                />
                <span class="min-w-[100px] text-sm text-gray-700 font-medium">No</span>
              </label>
            </div>
          </app-group-input-with-checkbox>
        </div>
        <app-base-error-messages
          [control]="getFormControl(locationInformationFormGroupControls['doYouCurrentlyHaveLocalAgentInKSA'])"
          [label]="'Do you currently have local Agent in KSA?'"
        />
      </div>

    </div>

    @if(showLocalAgentInformation()){
    <div
      class="animated flex flex-col gap-4"
      animate.enter="fadeIn"
    >
      <div class="flex flex-col gap-4 md:flex-row">
        <div class="flex flex-col gap-2 flex-1">
          <app-base-label [title]="'Local Agent Name'" />
          <app-group-input-with-checkbox
            [showCheckbox]="showCheckbox()"
            [hasCommentControl]="getHasCommentControl(localAgentInformationFormGroupControls['localAgentName'])"
            (valueChanged)="upDateSelectedInputs($event, {
              section: 'localAgentInformation',
              inputKey: 'localAgentName',
              label: 'Local Agent Name'
            })"
          >
            <input
              type="text"
              pInputText
              fluid
              placeholder="Enter local agent name"
              maxlength="100"
              [formControl]="getValueControl(localAgentInformationFormGroupControls['localAgentName'])"
              [appConditionalColorClass]="highlightInput('localAgentName')"
              [color]="selectedInputColor()"
            />
          </app-group-input-with-checkbox>
          <app-base-error-messages
            [control]="getValueControl(localAgentInformationFormGroupControls['localAgentName'])"
            [label]="'Local Agent Name'"
          />
        </div>
        <div class="flex flex-col gap-2 flex-1">
          <app-base-label [title]="'Contact Person Name'" />
          <app-group-input-with-checkbox
            [showCheckbox]="showCheckbox()"
            [hasCommentControl]="getHasCommentControl(localAgentInformationFormGroupControls['contactPersonName'])"
            (valueChanged)="upDateSelectedInputs($event, {
              section: 'localAgentInformation',
              inputKey: 'contactPersonName',
              label: 'Contact Person Name'
            })"
          >
            <input
              type="text"
              pInputText
              fluid
              [maxlength]="100"
              placeholder="Enter contact person name"
              [formControl]="getValueControl(localAgentInformationFormGroupControls['contactPersonName'])"
              [appConditionalColorClass]="highlightInput('contactPersonName')"
              [color]="selectedInputColor()"
            />
          </app-group-input-with-checkbox>
          <app-base-error-messages
            [control]="getValueControl(localAgentInformationFormGroupControls['contactPersonName'])"
            [label]="'Contact Person Name'"
          />
        </div>
      </div>
      <div class="flex flex-col gap-4 md:flex-row">
        <div class="flex flex-col gap-2 flex-1">
          <app-base-label [title]="'Email ID'" />
          <app-group-input-with-checkbox
            [showCheckbox]="showCheckbox()"
            [hasCommentControl]="getHasCommentControl(localAgentInformationFormGroupControls['emailID'])"
            (valueChanged)="upDateSelectedInputs($event, {
              section: 'localAgentInformation',
              inputKey: 'emailID',
              label: 'Email ID'
            })"
          >
            <input
              type="text"
              pInputText
              fluid
              placeholder="Enter email ID"
              [formControl]="getValueControl(localAgentInformationFormGroupControls['emailID'])"
              [appConditionalColorClass]="highlightInput('emailID')"
              [color]="selectedInputColor()"
            />
          </app-group-input-with-checkbox>
          <app-base-error-messages
            [control]="getValueControl(localAgentInformationFormGroupControls['emailID'])"
            [label]="'Email ID'"
          />
        </div>
        <div class="flex flex-col gap-2 flex-1">
          <app-base-label [title]="'Contact Number'" />
          <app-group-input-with-checkbox
            [showCheckbox]="showCheckbox()"
            [hasCommentControl]="contactNumberHasCommentControl()!"
            (valueChanged)="upDateSelectedInputs($event, {
              section: 'localAgentInformation',
              inputKey: 'contactNumber',
              label: 'Contact Number'
            })"
          >
            <app-phone-input
              [formControl]="getValueControl(localAgentInformationFormGroupControls['contactNumber'])"
              [appConditionalColorClass]="highlightInput('contactNumber')"
              [color]="selectedInputColor()"
            ></app-phone-input>
          </app-group-input-with-checkbox>
          <app-base-error-messages
            [control]="getValueControl(localAgentInformationFormGroupControls['contactNumber'])"
            [label]="'Contact Number'"
          />
        </div>
      </div>
      <div class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="col-span-1">
          <div class="flex flex-col gap-2 flex-1">
            <app-base-label [title]="'Company HQ Location'" />
            <app-group-input-with-checkbox
              [showCheckbox]="showCheckbox()"
              [hasCommentControl]="getHasCommentControl(localAgentInformationFormGroupControls['companyHQLocation'])"
              (valueChanged)="upDateSelectedInputs($event, {
                section: 'localAgentInformation',
                inputKey: 'companyHQLocation',
                label: 'Company HQ Location'
              })"
            >
              <input
                type="text"
                pInputText
                fluid
                maxlength="255"
                placeholder="Enter company HQ location"
                [formControl]="getValueControl(localAgentInformationFormGroupControls['companyHQLocation'])"
                [appConditionalColorClass]="highlightInput('companyHQLocation')"
                [color]="selectedInputColor()"
              />
            </app-group-input-with-checkbox>
            <app-base-error-messages
              [control]="getValueControl(localAgentInformationFormGroupControls['companyHQLocation'])"
              [label]="'Company HQ Location'"
            />
          </div>
        </div>
      </div>
    </div>
    }

    <app-comment-input
      [commentFormControl]="stepCommentFormControl"
      [commentPhase]="commentPhase()"
    />
  </div>
</div>

@if(showCheckbox() || showCommentState()){
<app-comment-state-component
  [commentsCount]="selectedInputs().length"
  [(commentPhase)]="commentPhase"
  [commentFormControl]="commentFormControl"
  [isResubmitMode]="isResubmitMode()"
  [hasInvestorComment]="hasInvestorComment()"
  (deleteComments)="onDeleteComments()"
  (saveComment)="commentPhase() === 'editing' ? onSaveEditedComment() : onSaveComment()"
  (startEditing)="onStartEditing()"
/>
}

@if(showDeleteConfirmationDialog()){
<app-general-confirmation-dialog
  [(visible)]="showDeleteConfirmationDialog"
  [title]="'Are you sure you want to delete the comment and selected fields?'"
  [confirmationLabel]="'Delete'"
  [cancelLabel]="'Cancel'"
  [confirmButtonSeverity]="'danger'"
  [icon]="'icon-trash-2'"
  (confirmed)="onConfirmDeleteComment()"
  (onCancel)="onCancelDeleteComment()"
/>
}
