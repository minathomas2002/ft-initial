<div class="flex flex-col gap-[32px] pb-10">
  <!-- Saudization Projection Matrix Section -->
  <div class="flex flex-col gap-4">
    <h2 class="text-lg font-semibold text-gray-900">Saudization</h2>

    <app-saudization-matrix
      [getValueControl]="getValueControlWrapper"
      [getHasCommentControl]="getHasCommentControlWrapper"
      [getRowControl]="getRowControlWrapper"
      [showCheckbox]="showCheckbox()"
      [upDateSelectedInputs]="upDateSelectedInputsWrapper"
      [highlightInput]="highlightInputWrapper"
      [selectedInputColor]="selectedInputColor()"
    />
  </div>

  @if((isViewMode() && files().length > 0) || !isViewMode()) {
  <!-- Attachments Section -->
  <div class="flex flex-col gap-4">
    <div>
      <h2 class="text-lg font-semibold text-gray-900">Attachments (Optional)</h2>
      <p class="text-xs text-gray-600"><span class="text-gray-600 font-semibold">Note:</span> all uploaded files size should be less than 30MB</p>
    </div>

    <app-group-input-with-checkbox
      [hasCommentControl]="getHasCommentControl(getAttachmentsFormGroup().get(EMaterialsFormControls.attachments)!)"
      [showCheckbox]="showCheckbox()"
      (valueChanged)="upDateSelectedInputs($event, {
        section: 'attachments',
        inputKey: 'attachments',
        label: 'Attachments'
      })"
    >
      <app-fileupload
        [isViewMode]="isViewMode()"
        [disabled]="isFileUploadDisabled()"
        [acceptedFileTypes]="'.pdf, .png, .jpg, .jpeg, .zip, .rar'"
        [(files)]="files"
        class="w-full"
        [placeholder]="'You can upload any file type (images, documents).'"
        [multiple]="true"
      />
    </app-group-input-with-checkbox>
    <app-base-error-messages
      [control]="getValueControl(getAttachmentsFormGroup().get(EMaterialsFormControls.attachments)!)"
      [label]="'Attachments'"
    />
  </div>
  }

  @if(commentPhase() == 'editing' || commentPhase() == 'viewing'){
  <div
    class="animated flex flex-col gap-4 mt-8"
    animate.enter="fadeIn"
  >
    <div class="flex flex-col gap-4 md:flex-row">
      <div class="flex flex-col gap-2 flex-1">
        <app-base-label [title]="'Your Comment'" />
        <textarea
          fluid
          rows="8"
          pTextarea
          [formControl]="commentFormControl"
        ></textarea>
        <app-base-error-messages
          [control]="commentFormControl"
          [label]="'Your Comment'"
        />
      </div>
    </div>
  </div>
  }

  @if(showCheckbox()){
  <app-comment-state-component
    [commentsCount]="selectedInputs().length"
    [(commentPhase)]="commentPhase"
    [commentFormControl]="commentFormControl"
    (deleteComments)="onDeleteComments()"
    (saveComment)="commentPhase() === 'editing' ? onSaveEditedComment() : onSaveComment()"
  />
  }

  @if(showDeleteConfirmationDialog()){
  <app-general-confirmation-dialog
    [(visible)]="showDeleteConfirmationDialog"
    [title]="'Are you sure you want to delete the comment and selected fields?'"
    [confirmationLabel]="'Delete'"
    [cancelLabel]="'Cancel'"
    [confirmButtonSeverity]="'danger'"
    [icon]="'icon-trash-2'"
    (confirmed)="onConfirmDeleteComment()"
    (onCancel)="onCancelDeleteComment()"
  />
  }
</div>