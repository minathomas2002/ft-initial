<div class="flex flex-col gap-6 bg-white">
  <app-summary-section-header
    [title]="'plans.wizard.step4.title' | translate"
    (onEdit)="onEditClick()"
    [isViewMode]="isViewMode()"
  />
  <!-- Saudization Matrix Table -->
  <div class="flex flex-col gap-4">
    <div class="overflow-x-auto rounded-lg">
      <p-table
        [value]="tableRows()"
        [scrollable]="true"
      >
        <ng-template pTemplate="header">
          <tr>
            <th class="p-3 !border !border-gray-200 text-left text-sm font-semibold !bg-gray-50 !text-gray-700 !whitespace-nowrap rounded-tl-xl"></th>
            @for (year of years; track year) {
            <th
              class="p-3 !border !border-gray-200 text-center text-sm font-semibold !bg-gray-50 !text-gray-700 !whitespace-nowrap"
              [class.rounded-tr-xl]="year === years[years.length - 1]"
            >{{ 'plans.summary.year' | translate }} {{ year }}</th>
            }
          </tr>
        </ng-template>
        <ng-template
          pTemplate="body"
          let-rowData
        >
          <tr>
            <td
              class="p-3 !border !border-gray-200 text-sm font-medium"
              [class.rounded-bl-xl]="rowData.controlName === EMaterialsFormControls.saudiCompensationPercentage"
            >
              <div class="flex flex-col">
                <span>{{ rowData.label }}</span>
                @if (rowData.subtitle) {
                <span class="text-xs text-gray-500">{{ rowData.subtitle }}</span>
                }
              </div>
            </td>
            @for (year of years; track year) {
            <td
              class="p-3 !border !border-gray-200 text-center"
              [class.rounded-br-xl]="year === years[years.length - 1] && rowData.controlName === EMaterialsFormControls.saudiCompensationPercentage"
            >
              <app-summary-table-cell
                [value]="formatValue(rowData['year' + year])"
                [hasError]="rowData['year' + year + 'HasError']"
                [hasComment]="rowData['year' + year + 'HasComment']"
              />
            </td>
            }
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <!-- Attachments -->
  <div class="flex flex-col gap-4">
    <h3 class="text-md font-semibold text-gray-900">{{ 'plans.summary.attachments' | translate }}</h3>
    @if (hasAttachments()) {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
      @for (file of attachments(); track $index) {
      <div class="p-3 rounded-border flex border border-surface justify-between items-center gap-4 w-full">
        <div class="flex items-center gap-3 flex-1 min-w-0">
          @if(file.type && file.type.startsWith('image/')){
          <img
            role="presentation"
            [alt]="file.name || 'File ' + ($index + 1)"
            [src]="file.objectURL || file.url"
            width="32"
            height="32"
            class="flex-shrink-0"
            appImageError
          />
          }@else if(getFileIcon(file)){
          <img
            role="presentation"
            [alt]="file.name || 'File ' + ($index + 1)"
            [src]="getFileIcon(file)"
            width="32"
            height="32"
            class="flex-shrink-0"
            appImageError
          />
          }@else{
          <span
            class="pi pi-file flex-shrink-0"
            style="font-size: 2em"
          ></span>
          }
          <div class="flex flex-col min-w-0 flex-1">
            <span class="font-semibold text-ellipsis whitespace-nowrap overflow-hidden text-sm text-gray-700">
              {{ file.name || 'File ' + ($index + 1) }}
            </span>
            @if (file.size) {
            <span class="text-xs text-gray-500">({{ (file.size / 1024).toFixed(0) }} KB)</span>
            }
          </div>
        </div>
      </div>
      }
    </div>
    } @else {
    <span class="text-sm text-gray-500">-</span>
    }
  </div>

  <!-- Comments Display (Read-Only) -->
  <app-summary-comments [pageComments]="pageComments()" />
</div>